18. 102 pus. 424 5 14 sense. 18 492 # , 64 29 30 263 26 98 https://arxiv.org/abs/1608.06315 https://www.biorxiv.org/content/ early/2018/07/25/376830 487 17 Online . 20 . CC-BY-NC-ND 4.0 International license under a which was this version posted September 20, 2018. ; https://doi.org/10.1101/418939 doi: bioRxiv preprint 17. Gr om ov , M . M et ricstru ct ur es forRi em annianandnon - Ri em annianspac es , Chapt er 3 Sprin ge rScience & BusinessMedi a, 2007 . Yu , B . M . et al . G au ssi an - processf ac t or an al ysisf or low - dimensi on al sin gl e - tri al an al ysis of neur al p op ul at i on ac tivity . Jo urnalofN eu rophysiolo gy , 614320635 2009 . 19. Har ris , K . D . , Csicsv ar i , J . , Hi r as e , H. , Dr agoi , G . & Buzs 253 ak i , G . Or gan iz at i on of cell as sembliesinthehippoc am - Natur e , 552 2003 . 20. Munkres , J . Al gor ithmsf or the as si gn ment an dtr an sp or t at i on pr ob lems . Jo urnaloftheSo ci et yforIndustrialandAppliedMath em ati cs , 3232038 1957 . 21. C oh en , M . R . & K oh n , A. Me as uring an dinterpretingneur on al c or rel at i on s . NatureN eu ros ci en ce , 811 2 011 . 22. Peyr ac he , A. , Lac r oi x , M . M . , Petersen , P . C . & Buzs 253 ak i , G . Intern al ly or gan izedmech an isms of thehe ad directi on NatureN eu ros ci en ce , 569 2015 . 23. Stens ol a, H. et al . Theent or hin al gr idm ap isdiscretized . Natur e , 72 2012 . 24. Berndt , D . J . & Cli or d , J . Us ingdyn am ictimew ar pingto 336 ndp at ternsintimeseries . InK DD Wor ks hopv ol . 10, 359320370 Se at tle , W A, 1994 . 25. St or ey , J . D . Adirect ap pr oac htof al sediscoveryr at es . Jo urnaloftheRoyalStatisticalSo ci et y : S er i es BStatisticalM et hodolo gy , 479320498 2002 . 26. Davis on , A. C . & Hi nkley , D . V. Bootstrapm et hodsandth ei rapplication , v ol . 1 C am brid ge Un iversityPress , 1997 . 27. Lah iri , S . N. R es amplingm et hodsford ep en d en tdataSprin ge rScience & BusinessMedi a, 2013 . 28. G ao, Y. , Ar cher , E . W . , P an inski , L. & Cunnin gh am , J . P . Li ne ar dyn am ic al neur al p op ul at i on modelsthr ou gh n on line ar embeddin gs . Ad va nc es inN eu ralInformationProc es singSyst em s , 163320171 2016 . 29. Wu , A. , Roy , N. G . , Keeley , S . & Pillow , J . W . G au ssi an processb as edn on line ar l at entstructurediscoveryinmultiv ar i at espiketr ai nd at a. Ad va nc es inN eu ralInformationProc es singSyst em s , 34963203505 2017 . 30. Li nderm an , S . W . , J oh ns on , M . J . , Wils on , M . A. & Chen , Z . ABayesi an n on p ar am etric ap pr oac hf or uncoveringr at hippoc am p al popul at i on codesduringsp at i al navi gat i on . Jo urnalofN eu ros ci en ceM et hods , 3632047 2016 . 31. Chen , Z . , G om perts , S . N. , Y am am ot o, J . & Wils on , M . A. Ne ur al represent at i on of sp at i al t op ol ogy intherodenthippoc am pus . N eu ralComputation , 132039 2013 . 32. Willi am s , A. H. et al . Un superviseddiscovery of demixed , low - dimensi on al neur al dyn am ics ac r os smultipletimesc al esthr ou gh tens or c om p on ent an al ysis . N eu ron , 10993201115. e 8 2018 . 33. Sussill o, D . , J oz efowicz , R . , Ab b ot t , L. & P an d ar in at h , C . LF AD S 320 l at entf ac t or an al ysisviadyn am ic al systems . ar Xi v 2016 . . 34. Wei , Z . , In agak i , H. , Li , N. , Sv ob od a, K . & Druckm an n , S . An or derlysin gl e - tri al or gan iz at i on of p op ul at i on dyn am icsinprem ot or c or texpredictsbehavi or al v ar i ab ility . bi oRxiv 2018 . . 35. Churchl an d , M . M . et al . Ne ur al p op ul at i on dyn am icsduringre ac hin g. Natur e , 5132056 2012 . 36. Cunnin gh am , J . P . & Yu , B . M . Dimensi on al ityreducti on f or l ar ge - sc al eneur al rec or din gs . NatureN eu ros ci en ce , 15003201509 2014 . 37. Fox , S . E . & R an ckJr , J . B . Improvedmethodf or me as uringthet op ol ogi c al dimensi on s of neur on al 336 ringr at esp ac e . Pr ogr am No. 616. 12. In 2 0 1 7 N eu ros ci en ceMe et ingPlann er W as hin gt on , DC : Societyfor Ne ur os cience , 2017 . # # 61 78 45 290 ! 24 100 4 543 95 19 . CC-BY-NC-ND 4.0 International license under a which was this version posted September 20, 2018. ; https://doi.org/10.1101/418939 doi: bioRxiv preprint fr om m an if ol dco or din at es as insecti on 10. ExtendedD at aFi g. 5c showsme an squ ar eddecodingerr or , estim at edusing 10 f ol dcr os s - v al id at i on overtemp or al lyc on ti gu ou sblocks of d at a. Decodingerr or w as 1. 8% , 57. 7% , an d 116. 6% gr e at erth an therawd at af or MI ND , is om ap , an dPC A, respectively . Theref or e , withdimensi on al itym at chedtothenumber of me as uredbehavi or al v ar i ab les , them an if ol drecoveredbyMI ND is ge om etric al lysimil ar totheenvir on ment . Furtherm or e , itc ap turesm os t of theinf or m at i on ab ou tther at 325 sp os iti on th at isav ai l ab letothedecoderintheraw 336 ringr at es . Inc on tr as t , is om ap an dPCArecoverm an if ol dsth at ar elesssimil ar totheenvir on ment , an dc ap turelessinf or m at i on ab ou tp os iti on . Determininghowsuchperf or m an cedierencesrel at etothev ar i ou sc on ceptu al dierencesbetweenmethodsis an interestingt op icf or futureinvesti gat i on . 1. Tippin g, M . E . & Bish op , C . M . Pr ob ab ilisticprincip al c om p on ent an al ysis . Jo urnaloftheRoyalStatisticalSo ci et y : S er i es BStatisticalM et hodolo gy , 611320622 1999 . 2. D as gu pt a, S . & Freund , Y. R an d om projecti on trees an dlowdimensi on al m an if ol ds . InProceedin gs oftheForti et h An nualACMSymposiumonTheoryofComputing , 537320546 ACM , 2008 . 3. Kp ot ufe , S . & D as gu pt a, S . Atree - b as edre gr ess or th at ad ap tstointrinsicdimensi on . Jo urnalofComput er andSyst em S ci en c es , 14963201515 2012 . 4. Breim an , L. R an d om f or ests . Ma ch ineLearning , 532032 2001 . 5. Friedm an , J . , Has tie , T . & Tibshir an i , R . The el em en tsofstatisticallearning , v ol . 1 Sprin ge rSeriesinSt at istics , Ne wY or k , 2001 . 6. v an derM aat en , L. , P os tm a, E . O . & v an den He rik , H. J . Dimensi on al ityreducti on : Ac om p ar at ivereview . Tech . Rep . TiCC - TR 2009- 005, Tilburg Un iversity 2009 . 7. Tenenb au m , J . B . , DeSilv a, V. & Lan gf or d , J . C . A gl ob al ge om etricfr am ew or kf or n on line ar dimensi on al ityreducti on . S ci en ce , 23193202323 2000 . 8. J oh ns on , D . B . Ecient al gor ithmsf or sh or testp at hsinsp ar senetw or ks . Jo urnaloftheACM , 132013 1977 . 9. S am m on , J . W . An on line ar m ap pingf or d at astructure an al ysis . IEEETransa ct ionsonComput er s , 401320409 1969 . 10. B or g, I . & Groenen , P . J . Mod er nmultidim en sionalscalin g: TheoryandapplicationsSprin ge rScience & BusinessMedi a, 2005 . 11. S au l , L. K . & Roweis , S . T . Think gl ob al ly , 336 tloc al ly : unsupervisedle ar ning of lowdimensi on al m an if ol ds . Jo urnalofMa ch ineLearningR es ear ch , 119320155 2003 . 12. T or go, L. F . R . A. Indu ct i ve learningoftre e- basedre gr es sionmod el s . Ph . D . thesis , Un iversid ad edoP or t o, Reit or ia 1999 . 13. DeSilv a, V. & Tenenb au m , J . B . Sp ar semultidimensi on al sc al ingusingl an dm ar kp oi nts . Tech . Rep . , St an f or d Un iversity 2004 . 14. Mink a, T . P . Au t om at icch oi ce of dimensi on al ityf or pc a. Ad va nc es inN eu ralInformationProc es singSyst em s 598320604 2001 . 15. Ar on ov , D . , Ne vers , R . & T an k , D . W . M ap ping of an on - sp at i al dimensi on bythehippoc am p al 320e nt or hin al circuit . Natur e , 719320722 2017 . 16. Fent on , A. A. & Muller , R . U. Pl ac ecelldisch ar ge isextremelyv ar i ab leduringindividu al p as ses of ther at thr ou gh the 336ring 336 el d. Proceedin gs oftheNationalAcad em yofS ci en c es , 31823203187 1998 . ' =0 . ' =0 . # 7 rithms, # 6 10 9 a # # # 10 6 18 . CC-BY-NC-ND 4.0 International license under a which was this version posted September 20, 2018. ; https://doi.org/10.1101/418939 doi: bioRxiv preprint 1 7 . 7 A na lysisofma ni foldre co ns tr uct ionerrorTodeterminewhetherp op ul at i on ac tivityrem ai ns on themanif ol dduringdevi at i on s , weex am inedthem an if ol drec on structi on err or 321t heEuclide an dist an cein 336 ringr at esp ac ebetweenp op ul at i on ac tivity an ditsprojecti on on them an if ol di . e , itsim age undertherec on structi on m ap , seeSecti on 3 . Wec al cul at edthePe ar s on c or rel at i on of rec on structi on err or withdecodingerr or , an dwith ab s ol utel ag. 95% c on 336 denceinterv al swereestim at edusingamovingblockbo ot str ap ap pr oac h 10000 iter at i on sto ac c ou ntf or temp or al dependence . 26, 27 St at i on ar ity of thetimeseriestobebo ot str ap pedw as 336 rstveri 336 edusing au gm entedDickey - Fuller an dPhillips - Perr on testswithmultiplel ags an dsi gn i 336 c an celevel 05. Blocksizef or themovingblockbo ot str ap sh ou ldbel ar ge en ou gh tocoverther an ge of temp or al dependenceinthed at a. Itw as ch os entobe at le as ttwicethel ag at whichthe au toc or rel at i on functi on of an ytimeseriesdecayedtoalevelth at w as st at istic al lyindistin gu ish ab lefr om zerowith 05 . Ch an gi ngtheblocksizedidn ot aect ou rresultstestedwithinaf ac t or of 2 . 1 8 Com pa risontoPCAa nd isomapInExtendedD at aFi g. 5 wec om p ar edMI ND toprincip al c om p on ent an al ysisPCA an dis om ap , tw owell - knownmethodsf or m an if ol dle ar ning an ddimensi on al ityreducti on . Wech os ethesemethodsbec au se of theirwidespre ad use , an dbec au seMI ND buildsdirectly on ide as fr om b ot htechniques . In ad diti on to ot herm an if ol dle ar ning al go- 6, 18, 2832037 al lthreemethodsservec om plement ar ypurp os es , an d ar eusefulindierentsitu at i on s . Afund am ent al simil ar itybetweenMI ND , PC A, an dis om ap isth at theyproducealow - dimensi on al represent at i on of thed at aby at temptingtopreservedist an ces . Al lthreemethodse # ectivelyuseaf or m of multidimensi on al sc al ingto ob t ai nlow - dimensi on al m an if ol dco or din at eswhereEuclide an dist an cesm at chdist an cesc om putedbetweenthe or i gi n al d at ap oi nts . PCA an dis om ap usecl as sic al MDS , where as MI ND usesS am m on m ap ping 320a v ar i an t of n on cl as sic al , metricMDSth at pl ac es gr e at eremph as is on preservingsm al ldist an ces . Ho wever , e ac htechniqueme as uresdist an cesbetweend at ap oi ntsinauniqueway . PCAusesEuclide an dist an ces , where as is om ap uses ge odesicdist an ces , which ar eestim at edfr om loc al Euclide an dist an cesbetweennei gh b or ingp oi nts . MI ND usesanoveldist an ceme as ureb as ed on estim at edtr an siti on pr ob ab ilitiesbetweennetw or kst at esseesecti on 1. 3 . F or e ac hmethod , thedist an ceme as ureis an essenti al ch oi ce go verningthetype of structuretoc ap ture . F or ex am ple , as ac on sequence of theirdist an ceme as ures , is om ap an dMI ND c an discovern on line ar m an if ol ds , where as PCAisrestrictedtotheline ar c as e . Ho wever , PCAism or ee ! cientwhentheunderlyingstructureistrulyline ar . An ot herimp or t an tdistincti on isth at MI ND c ap turesstructureinthedyn am ics of thesystem , where as PCA an dis om ap ar einsensitivetodyn am ics 320r an d om lypermutingthetemp or al or der of thed at aw ou ldn ot ch an ge their ou tput . Inc on tr as t , PCA an dis om ap ar esensitivetotherel at ivep os iti on s of d at ap oi ntsininputsp ac e , as ac on sequence of theiruse of Euclide an dist an ces . F or ex am ple , ch an gi ngthe 336 ringr at e of aneur on mi gh tstr on gl yectthedist an cesc om putedbetweennetw or kst at es . Ho wever , theMI ND dist an ceme as uredoesn ot directlydepend on the 336 ringr at esindierentst at es , butr at herhowthesystemmovesthr ou gh thesest at es . Inthism an ner , MI ND at temptstole ar nn at ur al dist an cesfr om thebehavi or of thenetw or kitself , r at herth an as cribe ap riorime an ingtop ar ticul ar dierencesin ac tivityp at terns . Toc om p ar emethodsqu an tit at ively , we 336 t 2d m an if ol dstop op ul at i on ac tivityrec or dedfr om r at 103 intheRFT . Bec au seis om ap doesn ot provideam ap pingfr om intrinsicm an if ol dco or din at esb ac kto ac tivitysp ac e , we as kedhowwelle ac hm an if ol dc ap turedtheme as uredbehavi or al v ar i ab les . Giventh at p os iti on inthe 2d envir on ment ac c ou ntsf or al ar ge p or ti on of thev ar i at i on in 336 ringr at esovertime , a 2d m an ifoldth at c ap turesthisstructuresh ou ldbesimil ar totheenvir on ment . Tovisu al izeresults , wepl ot tedm an if ol dco or din at esc ol or edbyther at 325 sp os iti on intheenvir on ment at e ac htimep oi ntExtendedD at aFi g. 5a . Them an if ol drecoveredbyMI ND smo ot hlyencodedp os iti on , where as dissimil ar p os iti on swerem or eintermixed on m an if ol dsrecoveredbyis om ap an dPC A. Toqu an tifythe ge om etricsimil ar itybetweenm an if ol d an denvir on ment , wec om p ar edtheEuclide an dist an cebetweeneveryp ai r of p oi nts on them an if ol dtothedist an cebetweenthec or resp on dingp ai r of p oi ntsintheenvir on mentExtendedD at aFi g. 5b . Pe ar s on c or rel at i on betweendist an cesw as 0. 76, 0. 55, an d 0. 23 f or MI ND , is om ap , an dPC A, respectively 2 p ai rs of p oi nts . Fin al ly , tome as urehowwellthem an if ol dc ap turedinf or m at i on ab ou tp os iti on , wedecodedp os iti on 25 , 19 13 17 pus. 424 14 107 ! 497 ! 5 20 199 17 93 16 48 16 94 11 . CC-BY-NC-ND 4.0 International license under a which was this version posted September 20, 2018. ; https://doi.org/10.1101/418939 doi: bioRxiv preprint 9. Ren ar t , A. & M ac hens , C . K . V ar i ab ilityinneur al ac tivity an dbehavi or . Curr en tOpinioninN eu ro bi olo gy 211320220 2014 . 10. D oi r on , B . , Li twin - Kum ar , A. , R os enb au m , R . , Ocker , G . K . & J os i 253 c , K . Themech an ics of st at e - dependentneur al c or rel at i on s . NatureN eu ros ci en ce , 383320393 2016 . 11. J oh ns on , A. , Fent on , A. A. , Kentr os , C . & Redish , A. D . Lo ok ingf or c ogn iti on inthestructurewithinthen oi se . Tr en dsinCo gn iti ve S ci en c es , 5532064 2009 . 12. Redish , A. D . Vi c ar i ou stri al an derr or . NatureR evi ew sN eu ros ci en ce , 147320159 2016 . 13. Har ris , K . D . , Csicsv ar i , J . , Hi r as e , H. , Dr agoi , G . & Buzs 253 ak i , G . Or gan iz at i on of cell as sembliesinthehippoc am - Natur e , 552320556 2003 . 14. C ar r , M . F . , J ad hav , S . P . & Fr an k , L. M . Hi ppoc am p al replayintheaw ak est at e : ap ot enti al substr at ef or mem or yc on s ol id at i on an dretriev al . NatureN eu ros ci en ce , 147320153 2011 . 15. Hop 336 eld , J . J . Ne urodyn am ics of ment al expl or at i on . Proceedin gs oftheNationalAcad em yofS ci en c es , 16483201653 2010 . 16. Pfeier , B . E . & F os ter , D . J . Hi ppoc am p al pl ac e - cellsequencesdepictfuturep at hstoremembered goal s . Natur e , 7432079 2013 . 17. Day an , P . Improving ge ner al iz at i on f or temp or al dierencele ar nin g: thesuccess or represent at i on . N eu ralCom - pu tati on , 613320624 1993 . 18. St ac henfeld , K . L. , B ot vinick , M . M . & Gershm an , S . J . Thehippoc am pus as apredictivem ap . NatureN eu ros ci en ce , 16433201653 2017 . 19. Mc Nau gh t on , B . L. et al . Decipheringthehippoc am p al p ol y gl ot : thehippoc am pus as ap at hinte gr at i on system . Jo urnalofExp er im en talBiolo gy , 173320185 1996 . 20. Wimmer , K . , Ny k am p , D . Q . , C on st an tinidis , C . & C om pte , A. Bump at tr ac t or dyn am icsinprefr on t al c or texexpl ai nsbehavi or al precisi on insp at i al w or kingmem or y . NatureN eu ros ci en ce , 431320439 2014 . 21. Seun g, H. S . Ho wthebr ai nkeepstheeyesstill . Proceedin gs oftheNationalAcad em yofS ci en c es , 1333932013344 1996 . 22. Zh an g, K . Represent at i on of sp at i al or ient at i on bytheintrinsicdyn am ics of thehe ad - directi on cellensemble : athe or y . Jo urnalofN eu ros ci en ce , 21123202126 1996 . 23. M az or , O . & Lau rent , G . Tr an sientdyn am icsversus 336 xedp oi ntsinod or represent at i on sbylocust an tenn al l ob eprojecti on neur on s . N eu ron , 661320673 2005 . 24. G al 253 an , R . F . , S ac hse , S . , G al izi a, C . G . & He rz , A. V. M . Od or - driven at tr ac t or dyn am icsinthe an tenn al l ob e al lowf or simple an dr ap id ol f ac t or yp at terncl as si 336 c at i on . N eu ralComputation , 9993201012 2004 . 25. G al le go, J . A. , Perich , M . G . , Miller , L. E . & S ol l a, S . A. Ne ur al m an if ol dsf or thec on tr ol of movement . N eu ron , 978320984 2017 . 26. v an derM aat en , L. , P os tm a, E . O . & v an den He rik , H. J . Dimensi on al ityreducti on : Ac om p ar at ivereview . Tech . Rep . TiCC - TR 2009- 005, Tilburg Un iversity 2009 . 27. 102 487 26 17 29 263 https://arxiv.org/abs/1608.06315 30 Online . https://www.biorxiv.org/content/ early/2018/07/25/376830 98 9 3 37 16 12 . CC-BY-NC-ND 4.0 International license under a which was this version posted September 20, 2018. ; https://doi.org/10.1101/418939 doi: bioRxiv preprint Yu , B . M . et al . G au ssi an - processf ac t or an al ysisf or low - dimensi on al sin gl e - tri al an al ysis of neur al p op ul at i on ac tivity . Jo urnalofN eu rophysiolo gy , 614320635 2009 . 28. Churchl an d , M . M . et al . Ne ur al p op ul at i on dyn am icsduringre ac hin g. Natur e , 5132056 2012 . 29. Chen , Z . , G om perts , S . N. , Y am am ot o, J . & Wils on , M . A. Ne ur al represent at i on of sp at i al t op ol ogy intherodenthippoc am pus . N eu ralComputation , 132039 2013 . 30. Cunnin gh am , J . P . & Yu , B . M . Dimensi on al ityreducti on f or l ar ge - sc al eneur al rec or din gs . NatureN eu ros ci en ce , 15003201509 2014 . 31. P ar k , M . et al . Bayesi an m an if ol dle ar nin g: theloc al lyline ar l at entv ar i ab lemodelll - lvm . InAd va nc es inN eu ralInformationProc es singSyst em s , 154320162 2015 . 32. G ao, Y. , Ar cher , E . W . , P an inski , L. & Cunnin gh am , J . P . Li ne ar dyn am ic al neur al p op ul at i on modelsthr ou gh n on line ar embeddin gs . Ad va nc es inN eu ralInformationProc es singSyst em s , 163320171 2016 . 33. Li nderm an , S . W . , J oh ns on , M . J . , Wils on , M . A. & Chen , Z . ABayesi an n on p ar am etric ap pr oac hf or uncoveringr at hippoc am p al p op ul at i on codesduringsp at i al navi gat i on . Jo urnalofN eu ros ci en ceM et hods , 3632047 2016 . 34. Sussill o, D . , J oz efowicz , R . , Ab b ot t , L. & P an d ar in at h , C . LF AD S 320 l at entf ac t or an al ysisviadyn am ic al systems . ar Xi v 2016 . . 35. Wu , A. , Roy , N. G . , Keeley , S . & Pillow , J . W . G au ssi an processb as edn on line ar l at entstructurediscoveryinmultiv ar i at espiketr ai nd at a. Ad va nc es inN eu ralInformationProc es singSyst em s , 34963203505 2017 . 36. Fox , S . E . & R an ckJr , J . B . Improvedmethodf or me as uringthet op ol ogi c al dimensi on s of neur on al 336 ringr at esp ac e . Pr ogr am No. 616. 12. In 2 0 1 7 N eu ros ci en ceMe et ingPlann er W as hin gt on , DC : Societyfor Ne ur os cience , 2017 . 37. Wei , Z . , In agak i , H. , Li , N. , Sv ob od a, K . & Druckm an n , S . An or derlysin gl e - tri al or gan iz at i on of p op ul at i on dyn am icsinprem ot or c or texpredictsbehavi or al v ar i ab ility . bi oRxiv 2018 . . 38. Willi am s , A. H. et al . Un superviseddiscovery of demixed , low - dimensi on al neur al dyn am ics ac r os smultipletimesc al esthr ou gh tens or c om p on ent an al ysis . N eu ron , 10993201115. e 8 2018 . 39. Muller , R . U. & Kubie , J . L. The 336 ring of hippoc am p al pl ac ecellspredictsthefuturep os iti on of freelymovingr at s . Jo urnalofN eu ros ci en ce , 41013204110 1989 . 40. D ab agh i an , Y. , Br an dt , V. L. & Fr an k , L. M . Rec on ceivingthehippoc am p al m ap as at op ol ogi c al templ at e . eL ife , e 03476 2014 . 41. Brody , C . D . & Han ks , T . D . Ne ur al underpinnin gs of theevidence ac cumul at or . Curr en tOpinioninN eu ro bi olo gy , 149320157 2016 . 42. Ziv , Y. et al . Lon g- termdyn am ics of C A1 hippoc am p al pl ac ecodes . NatureN eu ros ci en ce , 264 2013 . ztzt 24 zzW = { ui ,v i } Wi % zui # 366 zvi % Wzuizvi | ui # vi | tzz 25 # # # 17 . CC-BY-NC-ND 4.0 International license under a which was this version posted September 20, 2018. ; https://doi.org/10.1101/418939 doi: bioRxiv preprint 17.3 Lag estimation Le ad ing an dl aggi ngdevi at i on swerequ an ti 336 edbyestim at ingthetemp or al l ag betweenthepredictedp os iti on 366 an d ac tu al p os iti on at e ac htimep oi nt , usingdyn am ictimew ar pingDTW . DTW al i gn stwotimeseriesbyn on unif or mlystretching an dshrinkingthem al on gthetime ax istominimizeadist an ceme as ure . In ou r an al yses , DTWw as usedto al i gn an d 366 , producingaw ar pingp at hth at minimizedtheEuclide an dist an cebetweenp oi ntsinthew ar pedtimeseries : mi n 20 Thew ar pingp at hc on sists of aseries of p ai redtimep oi ntssuchth at ism at chedto 366 , withtimep oi ntsc on str ai nedtoincre as ec on tinu ou sly an dm on ot on ic al ly , an dtocovertheentirer an ge of thetimeseries . Thew ar pingp at hw as al soc on str ai nedbyrequiringth at didn ot exceed 5 s . Lag w as estim at ed as thetimeel ap sedbetweenthe ac tu al p os iti on at time an dthepredictedp os iti on as si gn edtoitbyDTW or theme an timeel ap sedifthereweremultiple as si gn ments . P os itivel ag indic at edth at 366 w as le ad ing , an dne gat ivel ag indic at edth at itw as l aggi ngbehind . F or al lsubsequent an al ysesinv ol vingestim at edl ags , weincluded on lytimep oi ntswherethe ac tu al p os iti on m at cheditsDTW - as si gn edpredictedp os iti on withhi gh c on 336 dence . Tomeetthiscriteri on , the ac tu al p os iti on mustf al lwithinthe 75% crediblere gi on f or thec or resp on dingpredictedp os iti on 321t hecentr al , ellips oi d al re gi on of theG au ssi an p os teri or distributi on gi venbyG au ssi an processre gr essi on c on t ai ning 75% of thepr ob ab ilitym as s . Thiscriteri on excludedp oi ntswherethetraject or iesdidn ot reli ab lym at ch , such as detourdevi at i on s . 1 7 . 4 Lag di stri but ionFi g. 4b an dExtendedD at aFi g. 2 showtheover al ldistributi on of estim at edl ags ac r os stime . Thepr ob ab ilitydensityfuncti on w as estim at edusingakerneldensityestim at or G au ssi an kernel , b an dwidthselectedusingtw o- f ol dblockedcr os s - v al id at i on . Thecumul at ivedistributi on functi on w as estim at ed as theempiric al CDF . Theover al lm agn itude of estim at edle ad an dl ag w as qu an ti 336 ed as theme an ab s ol utel ag ac r os stimep oi nts . F or theP oi ss on model , wec om putedtheme an an dst an d ar derr or of thisst at istic ac r os ssurr ogat ed at as ets . Totestthehyp ot hesisth at me an ab s ol utel ag w as gr e at erf or there al d at ath an theP oi ss on model , wec al cul at eda on e - t ai ledpv al ue as thefr ac ti on of surr ogat ed at as etswhereme an ab s ol utel ag w as gr e at erth an or equ al toth at inthere al d at a. 1 7 . 5 Si g ni 336ca ntlea ds & lagsWes ou gh ttoidentifyindividu al timep oi ntswherele ad or l ag w as unlikelytohave ar isenduetor an d om v ar i at i on as intheP oi ss on model . Ate ac htimep oi nt , wetestedthehyp ot hesisth at there al d at ah ad l ag of gr e at erm agn itudeth an theP oi ss on model . Tw o- t ai ledpv al ueswerec al cul at ed as thefr ac ti on of surr ogat ed at as etswherethe ab s ol utel ag w as gr e at erth an or equ al toth at inthere al d at a. To ac c ou ntf or multiplec om p ar is on soverm an ytimep oi nts , wec on tr ol ledthef al sediscoveryr at eFDR at alevel of 0. 05 , usingtheproceduredescribedin . Si gn i 336 c an tle ad s an dl ags wereidenti 336 ed as timep oi ntswithp os itive or ne gat ivel ag, respectively , an dFDRqv al uelessth an 0. 05. Bec au sether at 325 straject or yw as identic al f or there al d at a an dP oi ss on model , c om p ar ingindividu al timep oi ntsc on tr ol ledf or an yin 337 uence of loc al traject or ypr op erties on theestim at edl ag. 1 7 . 6 Deto ur de te ct ionDet ou rdevi at i on soccurredwhenthe ac tu al p os iti on dieredstr on gl yfr om thepredictedp os iti on , an dthisdierencec ou ldn ot be ac c ou ntedf or byle ad or l ag. Todetectdet ou rs , wec om p ar edthe ac tu al p os iti on at e ac htimep oi nttoitsDTW - as si gn edpredictedp os iti on . Theuse of DTW as si gn mentsexcludeddierencesduetole ad or l ag. Det ou rsweres ai dtooccurwhenthe ac tu al p os iti on fell ou tsidethe 95% crediblere gi on f or thec or resp on dingpredictedp os iti on 321 thecentr al , ellips oi d al re gi on of theG au ssi an p os teri or distributi on gi venbyG au ssi an processre gr essi on c on t ai ning 95% of thepr ob ab ilitym as s . rij # tj ! rijtjrijtrijf = fjtfjtfj # trijffj # trij # trij # t % 367 riti % % % % 23 ztt # 16 . CC-BY-NC-ND 4.0 International license under a which was this version posted September 20, 2018. ; https://doi.org/10.1101/418939 doi: bioRxiv preprint repl ac ethe ac tivityvect or on tri al bythe ac tivityvect or on tri al ,w hilepreservingthefrequencydependency of . Todos o, wec on sider as afuncti on of an d ar estrictlyincre as ingfrequencysweepsthr ou gh thes am efrequencyv al ues . Weline ar lyinterp ol at e at queryv al uestocre at eanew ac tivityvect or 367 . Wedothisf or al ltri al s , an dc on c at en at ethe 367 tocre at eashued ac tivityvect or f or cell . Tocre at eashuedd at as et , werepe at edthisprocedureindependentlyf or al lcells . Weused 250 n oi sec or rel at i on shu % esin ou r an al yses . Werem ar kth at thisshueprocedureisfe as ibleduetothetri al structure of theSMT , inwhichthes am esequence of me as uredbehavi or al v ar i ab lesispresented on everytri al , uptotemp or al resc al in g. An an al ogou sshueintheRFT , f or ex am ple , w ou ldbelessstr ai gh tf or w ar d . 1 6 Sy nt he tic pl a ce a nd grid ce ll da taSyntheticpl ac e an d gr idcell ac tivityw as usedtov al id at em an if ol ddiscoverymethods . Thisd at aw as ge ner at edusingamodelnetw or kc on t ai ning 50 pl ac ecells an d 50 gr idcells , drivenbythesimul at edtraject or y of ar at expl or ingatw o- dimensi on al boxwithsidelen gt h 88 cm . Theinst an t an e ou s 336 ringr at e of e ac hcellw as gi venbythe am plitude of itspl ac e or gr id 336 eld at thecurrentp os iti on of ther at , with ad ditivewhiteG au ssi an n oi sen oi sest an d ar ddevi at i on w as 1/5t hthesi gn al st an d ar ddevi at i on . Pl ac e 336 eldsweremodeled as is ot r op icG au ssi an functi on scenteredr an d om lyintheenvir on ment , withwidth 41. 6 cmfullwidth at h al fm ax imum ; FW HM . E ac h gr id 336 eldw as modeled as asum of G au ssi an bumpscentered on ahex agon al l at tice . Gridcellswere or gan izedinf ou rmodules , an d gr id 336 eldswithinamodulesh ar edach ar ac teristicsp ac in g, width , an d an gl e . Thel at ticesp ac ing an dbumpwidthf or e ac hmoduleincre as edbyaf ac t or of 1. 3 rel at ivetotheprevi ou smodule , withb as esp ac ing 39. 8 cm an db as ewidth 27. 4 cmFW HM . The an gl e of thehex agon al l at ticepr ogr essedinincrements of 15 ac r os smodules . Lat ticeph as eswerer an d om f or e ac h gr idcell . Thesep ar am eterswerech os ento ap proxim at elym at chprevi ou sexperiment al ob serv at i on s . 1 7 Deviationa na lysis 1 7 . 1 Pre di ct i ng be ha viorfromma ni fold co or di na tesToidentifydevi at i on sfr om codinginst an t an e ou sbehavi or intheRFT , wepredictedther at 325 sp os iti on fr om the 3d m an if ol dco or din at esrepresentingp op ul at i on ac tivity at e ac htimep oi nt . Timeseriesc on t ai ningp os iti on an dm an if ol dco or din at eswere 336 rstdowns am pledtoar at e of 4 Hz tospeedupsubsequentM on teC ar lo an al yses . Cr os s - v al id at i on w as usedtoav oi dover 336 ttingduringp os iti on decodin g, an dw as perf or medinablockedm an nertominimizetemp or al dependencebetweentr ai ning an dheld - ou td at a. Thetimeseriesc on t ai ningm an if ol dco or din at es an d an im al p os iti on werep ar titi on edintotenc on ti gu ou sblocks , an de ac hblockw as held ou tinturn . AG au ssi an processre gr essi on modelw as 336 ttotherem ai ningd at a, thenusedtopredictp os iti on fr om m an if ol dco or din at esintheheld ou tblockseeSecti on 10 f or det ai ls . Predicti on sf or al lheld - ou tblockswerethenc on c at en at edto gi veatimeseries 366 spec ifying thepredictedp os iti on at time . 1 7 . 2 Com pa risontoPoissonmo de lWhen an al yzingdevi at i on s , weusedtheP oi ss on model as anullmodel . Inthisc as e , ac tivityencodesther at 325 sinst an t an e ou sp os iti on byc on structi on , an d an ydierencebetweenthepredicted an d ac tu al traject or iesthr ou gh theenvir on mentisac on sequence of r an d om v ar i at i on . We 336 ttheP oi ss on model an d ge ner at edsynthetic ac tivity as inSecti on 5. 2000 surr ogat ed at as etswere ge ner at edf or e ac hr at , c on t ai ning 336 ringr at es al on gther at 325 s ac tu al traject or ythr ou gh theenvir on ment . Am an if ol dwithdimensi on al ity 3, ch os entom at chthere al d at aw as 336 ttotheexpected 336 ringr at esi . e . ther at efuncti on of theP oi ss on processf or e ac hcell as inSecti on 1. Thef or w ar dm ap pingf or thism an if ol dw as usedto ob t ai n 3d m an if ol dco or din at esf or e ac hsurr ogat ed at as et , as inSecti on 1. 5. 1. M an if ol dco or din at eswereusedtopredictp os iti on as described ab ovef or there al d at a, usingtw o- f ol dblockedcr os s - v al id at i on . 3 rfj 3 SjjSjsj ! Sjsj 3 sj ! 3 Sj 20 Sj 3 Sj 3 sjsjsjsjsj 3 sjRpj , 3 pj 1 RRj =1 | pj # 3 pj | , ibisisstbitisttritic ij ritit # bitrjtjt # bjtc ij = + 367 rit , 367 rjt , + 367 rit , 367 rit ,+ 367 rjt , 367 rjt , where + , xy ! % % abb % rijtijtfjtj -& j ! 15 . CC-BY-NC-ND 4.0 International license under a which was this version posted September 20, 2018. ; https://doi.org/10.1101/418939 doi: bioRxiv preprint 1 3 Si ng le -t rialre co ns tr uct ions co resToqu an tifyhowwellthepe ak p os iti on s an d am plitudesfr om therec on structed ac tivitym at chedth os einthed at a, we 336 rstselectedpe ak sfr om therec on structed ac tivity as f ol lowsseeSecti on 3 f or therec on structi on procedure itself Weselectedsi gn i 336 c an tpe ak s on e ac htri al , as inSecti on 11. F or a gi ventri al ,l etden ot ethesi gn i 336 c an tpe ak sf or therec on structed 336 ringr at e on tri al , an dletden ot ethesi gn i 336 c an tpe ak sf or there al 336 ringr at e . Le tden ot etheprim ar ype ak , as describedinSecti on 11. Top ai rwithac or resp on dingrec on structedprim ar ype ak , weusedthe Hu n gar i an al gor ithmtom at chelements of an d .W ethende 336 ned to be the e le ment as si gn edto , or tobeemptyi . e . , norec on structedpe ak s on th at tri al ifnoelementw as as si gn edto .W eusedthism at ching ap pr oac h as away of h an dlingtheexistence of multiplepe ak sinthe ac tivity an ditsrec on structi on , gi ven ou r goal of an al yzingasin gl epe ak pertri al . R at herth an simplyp ai ringwithitsne ar estreconstructedpe ak , thism or ec on serv at iveprocedurep ai redwiththene ar estrec on structedpe ak th at w as n ot m or eprefer ab lym at chedto an ot hersi gn i 336 c an tpe ak inthere al ac tivity . Ho wever , f ol low - up an al ysesmi gh ttre at multiplepe ak sm or edirectly . F or e ac hcell , on ceweh ad ach oi ce of rec on structedprim ar ype ak f or everytri al , wequ an ti 336 edthe agr eementbetweenthere al an drec on structedpe ak sbyc om putingtheme an ab s ol uteerr or M AE betweenre al an drec on structedp os iti on s an d am plitudes ac r os s al ltri al s . F or re al an drec on structedp os iti on s ,t hisis an dlikewisef or am plitudes . Onlessth an 3% of tri al s , eitherthere al or rec on structed 336 ringr at eh ad noprim ar ype ak , inwhichc as eth at tri al w as removed an ddidn ot c on tributetotheerr or . 1 4 Noise co rrelatio ns Wec om putedn oi sec or rel at i on s as in 21, 22 . F or cellrec or dedduringtheSMT , letden ot eitsbehavi or al 336 ring 336 eldseeSecti on 5 , which gi vestheexpected ac tivity of cell at s ou ndfrequency .I fden ot esthetimec ou rse of frequencythr ou gh ou tthebehavi or al sessi on , thenweletbden ot etheexpected ac tivity gi venthefrequencyv al ue at time , by ab use of n ot at ion . Ifden ot esthe 336 ringr at e of cell as afuncti on of time , wede 336 nethen oi sec or rel at i on as thePe ar s on c or rel at i on coe ! cientbetween 367 r an d 367 rth ou gh t of as vect or sindexedbytime . Inn ot at i on , thisis x, yden ot estheinnerproduct of vect or s an d . As asumm ar yst at isticinFi g. 3f , wec om putetheaver age ab s ol utev al ue of then oi sec or rel at i on s ac r os s al lcellp ai rs . 1 5 Noise co rrelationshuesTotestf or n oi sec or rel at i on sintheSMT , wede 336 nedashueprocedureth at preservedtheaver age s ou ndfrequencytuning of everycell , whileremoving an ytri al - by - tri al c or rel at i on sbetweencellsbey on dth os eresultingfr om theirfrequencytunin g. C on ceptu al ly , theshueisimplementedbyrepl ac ingacell 325 s ac tivity on tri al byits ac tivity on tri al , ch os en at r an d om , af terw ar pingtime on tri al soth at thefrequencysweepsinb ot htri al s ar e al i gn ed . Thisisrepe at edf or e ac htri al , an dthesameshueisthenrepe at edindependentlyf or e ac hcell . Indet ai l , letden ot ethe 336 ringr at e of cell on tri al as afuncti on of time , an dletden ot es ou ndfrequency as afuncti on of time on thes am etri al . Cho os ear an d om permut at i on of tri al l ab els , .W ewill ! ! 2632038 41 42 7 321 543 5. 35 95 14 273 10 . CC-BY-NC-ND 4.0 International license under a which was this version posted September 20, 2018. ; https://doi.org/10.1101/418939 doi: bioRxiv preprint thr ou gh behavior . Ne i gh b or ing an dp ar ti al lyoverl ap ping 336 eldsrepresentthe or der an d ad j ac ency of behavi or al st at es , usefulinlinkingeventsinepisodicmem or y , 1, 5, 14 pl an ningfuture ac ti on s , 12, 15, 16 an dreinf or cementle ar nin g. 17, 18 He reweexp an dth at c on ceptu al picturebydem on str at ingth at , intwodierentc ogn itivet as ks , thep op ul at i on level ac tivityinthehippoc am pusliesne ar rel at ivelylow - dimensi on al m an if ol dsinthest at esp ac e of neur al ac tivity . Previ ou sly ob served 336 ring 336 eldsequencesc or respondtomovementsthr ou gh ad j ac entst at es on them an if ol d . Imp or t an tly , them an if ol dstructuren ot on lydeterminesthecl as sic al tuningpr op ertiesbehavi or al 336 ring 336 eldsbuttheneur al v ar i ab ility as well . Inthisnewc on ceptu al view , duringr an d om f or agi nginsp ac e , 322p l ac e 323 cellsdon ot 336 rebec au sethe an im al entersthepl ac e 336 eld ; they 336 rewhentheneur al circuittraversesthem an if ol d 336 eld . Sin gl etri al ac tivityaver age d ac r os sm an if ol dtravers al sproducethebehavi or al 336 ring 336 elds , butdierenttraject or iesproducev ar i ab ility , re 337 ectingintern al dyn am ics of thesystem . Imp or t an tly , thisv ar i ab ilityisn ot r an d om , butstructured ac c or dingtothem an if ol d , producingn oi sec or rel at i on s . Inthisview , neur al coding an dstructuredv ar i ab ility ar ec as tinac om m on fr am ew or k : b ot hc or resp on dtomovement al on gthes am em an if ol d . Lar ge sc al erec or ding of neur al ac tivity at cellul ar res ol uti on isbeingincre as in gl yusedtome as ureneur al circuitdyn am ics at thep op ul at i on levelduringbehavi or . MI ND ad dstotheemer gi ngset of methodsf or ch ar ac terizingthisnetw or k ac tivity as low - dimensi on al traject or iesinst at esp ac e an d an al yzingitspr op erties . Our fo cus hereh as been on usingMI ND - b as edm an if ol dch ar ac teriz at i on an d an al ysistopr ob ethe or i gi n of v ar i ab ilityinthehippoc am pus , butitsh ou ld al sobeusefulinch ar ac terizingneur al dyn am icsinsens or ypercepti on , 8, 23 m ot or c on tr ol 25, 28 an dc ogn itivet as kssuch as w or kingmem or y 20, 21 an dinte gr at i on of evidenceduringdecisi on - m ak in g. Future goal sincludedetermininghow ge ner al m an if ol ds ar einbr ai ndyn am ics , howtheir ge om etricstructure an dt op ol ogy depends on the ar e as rec or ded , howtheirpr op ertiesev ol veovertime , an dhowspeci 336 cf or ms of c om put at i on such as decisi on - m ak in g, mem or yrec al l , or ac ti on pl an ningc an bebetterunderstoodinthec on ceptu al fr am ew or k of movement al on g or betweenm an if ol ds 321a ge ner al ap pr oac hth at maybeth ou gh t of as 322c om putingwithm an if ol ds . 323 Acknowled ge ments : Weth an k A. Ak r am i , R . Ch au dhuri , C . D om nis or u , I . Fiete , J . Pillow , M . Sch ot td or f , an dB . Sc ot tf or insi gh tfuldiscussi on s an dc om ments on them an uscript . Theillustr at i on sinFi g. 2a ar ebyJ . Kuhl . Thisw or kw as supp or tedbytheSim on sC ol l ab or at i on on theGl ob al Br ai n . 1. M os er , M . - B . , Rowl an d , D . C . & M os er , E . I . Pl ac ecells , gr idcells , an dmem or y . ColdSpringHarborP er spe ct i ves inBiolo gy 2015 . 2. P as t al kov a, E . , Itskov , V. , Am ar as in gh am , A. & Buzs 253 ak i , G . Intern al ly ge ner at edcell as semblysequencesinther at hippoc am pus . S ci en ce , 13223201327 2008 . 3. Ar on ov , D . , Ne vers , R . & T an k , D . W . M ap ping of an on - sp at i al dimensi on bythehippoc am p al - ent or hin al circuit . Natur e , 719320722 2017 . 4. O 325 Keefe , J . & Nad el , L. Thehippocampusasaco gn iti ve mapOxf or d : Cl ar end on Press , 1978 . Sc hiller, D. et al . Mem or y an dsp ac e : Tow ar ds an underst an ding of thec ogn itivem ap . Jo urnalofN eu ros ci en ce , 1390432013911 2015 . 6. Fent on , A. A. & Muller , R . U. Pl ac ecelldisch ar ge isextremelyv ar i ab leduringindividu al p as ses of ther at thr ou gh the 336ring 336e ld. Proceedin gs oftheNationalAcad em yofS ci en c es , 31823203187 1998 . 7. C oh en , M . R . & K oh n , A. Me as uring an dinterpretingneur on al c or rel at i on s . NatureN eu ros ci en ce , 811320819 2011 . 8. Ar ieli , A. , Sterkin , A. , Grinv al d , A. & Ae rtsen , A. Dyn am ics of on goi ng ac tivity : expl an at i on of thel ar ge v ar i ab ilityinev ok edc or tic al resp on ses . S ci en ce , 18683201871 1996 . kT bu ! ii =1 istrt where stxy fitrgp kkkr = rfrr / r / findpeaks r , frffffSSfSiSiSi 14 . CC-BY-NC-ND 4.0 International license under a which was this version posted September 20, 2018. ; https://doi.org/10.1101/418939 doi: bioRxiv preprint Tominimizethein 337 uence of loc al temp or al c or rel at i on s , weemployedablockedcr os s - v al id at i on ap pr oac h . We 336 rst divided time in to c on ti gu ou sblocks of equ al size , an dweremovedthel as t = 1 sec on dfr om e ac hblock . F or thethcr os s - v al id at i on f ol d , ,. .., k ,t hethblockw as held ou t as thetestset , an dtherem ai ningblockswerec om binedtof or mthetr ai ningset . Wethentr ai nedaGPRmodeltopredictfr om usingl an dm ar kp oi ntsfr om thetr ai ningsetwetr ai ned on l an dm ar kp oi ntsf or c om put at i on al re as on s ; seeSecti on 1. 6. 3 f or theirde 336 niti on . IntheRFT , w as the an im al 325 sp os iti on , wetre at ed an dp os iti on ssep ar at ely , 336 ttingindependentmodelstopredicte ac hco or din at e . Themodel 336 tswereperf or medusingthefuncti on inM at l ab 2018a, withdef au ltp ar am etersi . e . , usingthesqu ar edexp on enti al kernel , withhyperp ar am eters 336 tbym ax imizingthem ar gi n al likelihood . F or e ac hf ol d , we ap pliedthetr ai nedmodeltothetestset , an dde 336 nedthetestseterr or tobetheaver age Euclide an dist an cebetweenthetrue an dpredictedbehavi or al v ar i ab les . Wede 336 nedthe 336 n al decodingerr or tobetheaver age of thetesterr or s ac r os s al lf ol ds . Theerr or b ar sinFi g. 2c indic at ethest an d ar ddevi at i on of thetestseterr or s . Weto ok = 10 in ou r an al yses . 1 1 A na ly zi ng si ng le -t riala ct ivityint he SM TIntheSMT , we an al yzedsin gl e - tri al ac tivitybyselectingpe ak sinthe 336 ringr at e on e ac htri al , usingthef ol lowing pro cedure. We an al yzede ac hSMTd at as etsep ar at ely . We 336 rstremoved al lcellsth at 336 redfewerth an 5 spikespertri al , unlessthisleftlessth an 10 cells , inwhichc as eweto ok the 10 cellswiththehi gh estm ax imum 336 ringr at ef or r at s 103, 106, an d 107, thisresultedin 11, 10, an d 10 cells , respectively . F or a 336 xedcell an dtri al , wede 336 nedaset of si gn i 336 c an tpe ak s on th at tri al . Si gn i 336 c an tpe ak swerede 336 ned as pe ak sinthe 336 ringr at evs . l og frequencycurves at isfyingtwocriteri a: 1 theyexceededme an s . d . , an d 2 theyh ad ape ak pr om inenceexceedingme an r 2, me an ingtherew as avertic al dr op of at le as tme an 2 on e ac hside of thepe ak bef or e an ot herpe ak or theed ge of thesi gn al w as re ac hed . Weimplementedthisusingthefuncti on inM at l ab 2018a, af terzerop ad dingthesi gn al on theleft an dri gh ttoensureth at ed ge p oi ntsc ou ldbeincluded as pe ak s . Inwh at f ol lows , as well as inthem ai ntext , werefertotheloc at i on i . e , frequencyv al ue of ape ak as its po sition an dwerefertothehei gh t of ape ak as its am pl i tu de . F or simplicity , wen or m al izedthevect or of l og frequencybinstotheinterv al [ 0 , 1] bysubtr ac tingitsminimumv al ue an dthendividingbyitsm ax imum . Furtherm or e , f or e ac hcell , wesc al edbyitsm ax imumv al ue ac r os stri al s . Theref or e , pe ak p os iti on s an d am plitudese ac hr an ge dbetween 0 an d 1. F or simplicity , we an al yzedtri al - t o- tri al v ar i ab ilitywithrespectto on eprim ar ype ak loc at i on , an ddidn ot c on sidermultiplepe ak s . Theref or e , f or e ac hcell an dtri al , weneededtocho os eaprim ar ype ak fr om theset of si gn i 336 c an tpe ak s on th at tri al . Ho wever , since ou r goal w as toqu an tifype ak v ar i ab ility , weneededtoav oi d ar tif ac tu al v ar i ab ilitywhichw ou ld ar isefr om cellswithmultiplepe ak s , ifweselectedmism at chedprim ar ype ak sfr om tri al totri al . Tothisend , f or e ac hcell , wesimplych os ethe as si gn ment of prim ar ype ak stotri al swhichm ad ep os iti on v ar i ab ility as sm al l as p os sible . Al gor ithmic al ly , weimplementedthis as f ol lows : f or a gi venfrequencybin , weto ok theprim ar ype ak s on e ac htri al tobethesi gn i 336 c an tpe ak swithp os iti on cl os esttoincludingnoselecti on , ifthetri al h ad nosi gn i 336 c an tpe ak s . F or e ac h , wec om binedtheseprim ar ype ak sintoaset , an dc om puteditsp os iti on v ar i ab ilitysc or e , de 336 ned as theinterdeciler an ge of thep os iti on s of al lpe ak sin . Weiter at edthisprocedureover al lfrequencybins , an dto ok thesetwiththesm al lestv ar i ab ilitysc or e as theset of tri al - by - tri al pe ak sf or cell . 1 2 Q ua nti 336ca tionoftrial -t o -t rialvaria bi lityTheprocedureinSecti on 11 de 336 nedaset of prim ar ype ak sf or e ac hcell , with at m os t on epertri al . Werefertothesets of p os iti on s an d am plitudes of thepe ak sin as thep os iti on an d am plitudedistributi on sf or cell ,r espectively , as showninFi g. 3b t op . Wequ an ti 336 edv ar i ab ilityf or e ac hcellbyc om putingtheinterdeciler an ge of itsp os iti on an d am plitudedistributi on s , as showninFi g. 3b b ot t om . d { xt } dBRdidci ! Rdai ! R % i ! Rtirixtaie $ ! t " i ! 2 2 { t } m { xBsx 1 { x 1 ttstt % t # xt % st = tstxt | st #% xt # xt % | xtxt +1 xtxt 1 , i.e., % xt +1 # xt % < % xt +1 # xt $ 1 % mT . s = . 1, mTai % i = . cidB . iaiiciBai to % iai ,c i % irixt % irixti fminbnd { t } YX { st } . 13 . CC-BY-NC-ND 4.0 International license under a which was this version posted September 20, 2018. ; https://doi.org/10.1101/418939 doi: bioRxiv preprint 9 Si m ul ated hi g h-di me ns io na l pl a ce ce llsTov al id at e ou rintrinsicdimensi on al ityestim at or , wec on structedaset of simul at edhi gh - dimensi on al d at as ets , modeled as ide al izedpl ac ecellsf or ar at f or agi nginahi gh - dimensi on al ar en a. An ydimensi on al ityestim at or willbesubjecttothe 322c urse of dimensi on al ity , 323 inth at thes am plec om plexity of thedimensi on al ityestim at i on pr ob lemwill ge ner al lybeexp on enti al inthetruedimensi on al ity . Theref or e , in ad diti on toide al ized , hi gh ly - s am pledsimul at i on stov al id at ethede 336 niti on an dimplement at i on of theestim at or , we al sotestedtheestim at or on simul at i on swiths am plingm at chedtothed at a. F or e ac hdimensi on al ity , asimul at edd at as etc on sisted of aset of 336 ringr ate sovertime , de 336 nedintermsofatraject or y in the - dimensi on al unitb al li . e . , theset of p oi ntsinwithn or mlessth an or equ al to 1 . The 336 ringr at e of cellw as determinedbyits 336 ring 336 eld , whichw as modeled as a - dimensi on al G au ssi an bumpwithcenter , am plitude , an dst an d ar ddevi at i on .A ttime , the 336 ringr at e of cellw as gi venbyxc ! Ther an d om traject or yxw as ge ner at ed as f ol lows . We 336 rstch os easet of un or deredvect or s } unif or mly at r an d om fr om . Wecre at edatraject or yby or deringthesevect or svia an iter at iveprocedure , de 336 nedinterms of ap ar am eterwhichspeci 336 edthe ap proxim at estepsize . Theprocedurew as initi al izedbycho os ing at r an d om fr om x } . Ne xt , gi ven an or dering ,. .., x up to time , wede 336 nedat ar ge tf or thethstepsizei . e . , thedist an cex +1 byt ak ing ,w herew as ch os enr an d om lyfr om [ 0 , 1] at e ac hstep . Thenextvect or +1 w as thench os entominimizethev al ue +1 subjecttothef ol lowingcriteri a: 1 +1 w as n ot al re ad ych os eninthesequence ; 2 w as cl os ertoth an to $ Thisl as tcriteri on enc ou r age dthetraject or ytomovef or w ar ds ; ifnorem ai ningvect or ss at is 336 edit , itw as i gn or ed . Fin al ly , weline ar lyinterp ol at edthissequence of vect or store ac hat ar ge ttraject or ylen gt h of tim es te ps . Weveri 336 edth at thetraject or iesh ad nounre al isticdisc on tinuitiesbyensuringth at thel ar ge ststepsizew as lessth an 2 sIn al lsimul at i on s , weto ok = 5000, an d = 17500 thenumber of timestepsinther at 103 RFTd at as et . F or thehi gh ly - s am pledide al izedsimul at i on s , weused 128 cells , with = 1 an d 5 f or e ac hcell . Wede 336 ned cen t ers tobevertices of theunitcubecentered at the or i gi n , ch os enr an d om lywith ou trepl ac ement . Whentherewerem or eth an 2 centers , wech os etherem ai ningcentersunif or mly at r an d om fr om F or thed at a- m at chedsimul at i on s , wem at chedthecellp ar am eterstopr op erties of ther at 103 RFTd at as et . Weusedthes am enumber of cells 52 , an df or the th ce ll, wesetequ al tothem ax imum 336 ringr at e of the th ce ll inthed at as et . Wech os e 336 eldcentersindependently an dunif or mly at r an d om fr om . Ne xt , havingch os enm at che ac hcell 325 sm ax imum 336 ringr at e , we ad justedin or dertom at che ac hcell 325 sme an . Speci 336 c al ly , af tercho os ing , an dc om putingthetraject or y as ab ove , ach oi ce of determinedthe 336 ringr at e . Wetheref or euseda 1d b ou nded op timiz at i on r ou tineto 336 ndthev al ue of intheinterv al [ 0 , 2] whichminimizedthedist an cebetweenme an an dtheme an of thethcell 325 strue 336 ringr at e . Weimplementedthis op timiz at i on withM at l ab 325 sfuncti on . Fin al ly , we ap pliedthes am eP oi ss on n oi seprocedure as describedinSecti on 5, ge ner at ingsmo ot hedP oi ss on spiketr ai nsfr om theunderlyingsimul at ed 336 ringr at es . F or al lsimul at i on s , wer an theMI ND al gor ithmwiththes am ep ar am eters as f or thed at a. 1 0 De co di ng meas ur edbe ha vioralvaria bl esWeperf or meddecodingusingcr os s - v al id at edG au ssi an processre gr essi on GPR . Ourinputswereaset of vect or srovertime , eitherlow - dimensi on al embeddingco or din at es , or netw or kst at es . The ou tputstobedecodedwerebehavi or al v ar i ab lesXkkLddiiN # X ! i $ RN $ 1 Xi $ Ri . XikX train ! iY train ! i $ Rdg train f, ! i : RN $ 1 & Rdg train p, ! i : Rd & R train ! i , X train iLjL = Lg train p, ! iX ! i , Xi , idL i,d = kj =1 LL # y % 2 /T xyTLdLd = 1 NNiL i,d , xitityttciici = 1 % t " LM xitt LM xit 341 yt 12 . CC-BY-NC-ND 4.0 International license under a which was this version posted September 20, 2018. ; https://doi.org/10.1101/418939 doi: bioRxiv preprint 7 Peer -pr e di ct ions co re As acr os s - v al id at edme as ure of rec on structi on perf or m an cef or e ac hm an if ol ddimensi on al ity , wec om putedpeer - predicti on or 322l eave - neur on - ou t 323 sc or es as describedin . 18, 19 Thepeer - predicti on sc or equ an ti 336 estheextenttowhicha gi venmodelc an beusedtopredictthe ac tivity of on ecellfr om the ac tivity of its 322p eers 323 the ot herrec or dedcells . F or e ac hd at as et of ac tivityvect or s , wec om putedthesc or e as f ol lows . Theprocedurerequirescr os s - v al id at i on withrespecttotime as well as neur on s . Theref or e , webe gan byc on structingsplits of thetimep oi ntsintotr ai ning an dtestset , usingtheproceduredescribedinSecti on 10. Weto ok = 4 f or e ac hd at as et . Weusedthesetemp or al splitsf or therest of the an al ysis . The an al ysisproducesasin gl esc or ef or e ac hm an if ol ddimensi on al ity , whichitselfis an aver age oversc or es , on ef or e ac hch oi ce of h ol d - ou tcell . F or e ac hch oi ce of cell ,w eremovedcellfr om thed at as et , resultinginaset of 1- dimensi on al 322p eer 323 ac tivityvect or s , as well as theset of ac tivityv al uesf or cellc an beth ou gh t of as aset of ac tivityvect or sf or ap op ul at i on of size on e . F or e ac hch oi ce of on e of thetemp or al splits , we ap pliedtheMI ND al gor ithmtothetr ai ningset to pro duc eintrinsicco or din at es , as well as af or w ar dm ap ping . Then , usingthes am ere gr essi on al gor ithm as f or thef or w ar d an dreversem ap pin gs , wele ar neda 322p redicti on m ap pin g323 , tr ai ned on input - ou tputp ai rsfr om Y . Thepredicti on m ap pingrec on structsthe ac tivity of theheld - ou tcellfr om the ac tivity of itspeers . Itw as tr ai ned on l an dm ar kp oi nts on ly , as inthe or i gi n al al gor ithm . Le tden ot each oi ce of l os sfuncti on , an dletbe an indexden ot ingthech oi ce of temp or al split . Wec om putedthel os sf or e ac htemp or al - split : i,j ,d te st te st whichweusedtoc om putethetestl os sf or cell an dm an if ol ddimension al ity i,j ,d Weto ok x, y % xw he re an d ar esc al ar timeseries of len gt h , an dwethende 336 nedthepeer - predicti on sc or etobetheme an Euclide an err or f or e ac hcell , =1 soth at the 336 n al l os sfunti on w as ame an ro ot me an squ ar ederr or RMSE ac r os scells . Fin al ly , f or c om put at i on al re as on s , the an al ysisw as restrictedtothe 30 cellsfr om e ac hbehavi or al sessi on withthehi gh estm ax imum 336 ringr at eifthesessi on h ad fewerth an 30 cells , al lcellswereused . 8 Fieldsta bi lity pl otsToex am ine 336 eldst ab ilitywesplitther at 1 03 SMTd at as etintoits 336 rst an dsec on dh al ves . WethenusedMI ND tosep ar at ely 336 ta 2d m an if ol dtoe ac hh al f 2 beingthe op tim al dimensi on , as previ ou slyestim at ed , an dwe as sessedst ab ilitybypl ot tingthe 336 ring 336 eldsfr om the 336 rst an dsec on dh al fsidebysidef or e ac hcell . Fieldswerepl ot tedf or the 15 cellswiththehi gh est 336 ringr at e ac r os sthesessi on . Wem ar kedthecenter of m as s of e ac h 336 eldinred . Ifden ot esthe 336 ringr at e of thethcell at time , LM den ot estheset of timep oi ntsc or resp on dingtol an dm ar kp oi nts , an dden ot esthe 2d m an if ol dco or din at esf or thest at e at tim e , thenthecenter of m as sf or the th ce ll is " 16 2 2 bisis 2 bisbisstbisbistbitibit # 17 dG = GdX = { xt } $ RNY = { t } $ Rd 367 X = { 367 xt } $ RN # 367 XXYd % a % a . YXS = { st } 265 SSrS { % st # 265 S % } y ! Yy ! rXrYy # 265 YGG = # G 1 ,G 2 G 1 { % xt # 367 xt % } G 2 vjjRdii = j , vH v, Yy " Y % v # y % vYG 2 { H 261 vj , Y } vj ,1 " j " d As dG 1 G 2 dGd # # 17 it GdGdGd 11 . CC-BY-NC-ND 4.0 International license under a which was this version posted September 20, 2018. ; https://doi.org/10.1101/418939 doi: bioRxiv preprint 5 Poissonmo de la nd be ha vioral 336r i ng 336e l ds Wetestedthehyp ot hesisth at thehippoc am p al ac tivitym an if ol dsc on t ai nedstructurebey on dtheme as uredbehavi or al v ar i ab lesbyc om p ar ingthere al d at atoaP oi ss on nullmodel . Un derthismodel , e ac hneur on 325 s ac tivityw as ge ner at ed ac c or dingtoitsbehavi or al 336 ring 336 eld , an ddidn ot c on t ai n an ys ou rces of v ar i ab ilitybey on dP oi ss on n oi se . Tode 336 nebehavi or al 336 ring 336 eldsf or e ac hcell , wedividedtheme as uredbehavi or al v ar i ab lesp os iti on intheRFT or s ou ndfrequencyintheSMTintodiscretebins , usingbinsizes of 2 cmf or p os iti on an d . 06 l og k Hz f or frequency . Theunsmo ot hedbehavi or al 336 ring 336 eldw as gi venbytheaver age 336 ringr at e of cell in bin . Wesmo ot hedusingaG au ssi an kernelwithst an d ar ddevi at i on 1. 5 timesthebinsizetoproducethebehavi or al 336 ring 336 eld Giv en the time series of behavi or al v ar i ab lesme as uredine ac hsessi on , weline ar lyinterp ol at edthebehavi or al 336ring 336eld tode 336 nethetime - v ar yingr at e , whichweden ot eby ab use of n ot at i on . ThesyntheticP oi ss on spiketr ai nf or cellw as thende 336 ned as as am plefr om an inh om oge ne ou sP oi ss on processwithunderlyingr at e . Werepe at edthisproceduref or al lcells , producingasimul at edd at as etwhichwe an al yzedex ac tly as there al d at a. F or thedimensi on al ity an al ysisinFi g. 2b , weused 100 simul at edd at as ets . 6 Intri ns ic di me ns io na litys co reToestim at e an op tim al m an if ol ddimensi on al ity , wede 336 ned an intrinsicdimensi on al itysc or e , ad ap tedfr om theGr om ov - Hau sd or dist an cebetweenmetricsp ac es . F or e ac hdimensi on al ity , thesc or ew as c om putedusingthe or i gi n al d at ap oi nts , theirlow - dimensi on al m an if ol dco or din at esy , an dtheirrec on structi on s . Thesc or eimplementedatr ad eobetweentwoterms , on equ an tifyinghowsimil ar w as to , the ot herqu an tifyinghowsimil ar w as toaunif or m - dimensi on al b al l . Intheexpressi on sbelow , den ot estheEuclide an n or m of vect or We 336 rsttr an sf or medthevect or sinsotheywere on thes am esc al e as thevect or sin , as f ol lows . F or aset of vect or s ,l etden ot etheme an of , an dletden ot eitsr ad ius , whichwede 336 ned as the 95t hpercentile of thedist an ces . Wesc al ede ac helementbythetr an sf or m at i on Thesc or ew as thende 336 ned as thene gat ive of them ax imum of twoterms , m ax weto ok thene gat ivesoth at the op tim al dimensi on al ityoccured as ape ak r at herth an atr ou gh , f or thepurp os e of visu al iz at i on . We de 336 nedtobethe 95t hpercentile of therec on structi on err or s . To de 336 ne ,l etden ot ethethco or din at evect or ini . e . thevect or withthco or din at eequ al to 1 if an d 0 ot herwise . F or avect or ,l etminden ot etheminimumdist an cefr om toavect or in .W ede 336 nedtobethe 95t hpercentile of theset of dist an ces ac r os s al l . incre as es , go esdown as therec on structi on h as m or ede gr ees of freed om f or 336 ttingthe or i gi n al d at a, but go esup as them an if ol dco or din at es of the ac tivityvect or s ar eless ab leto 336 llupsp ac einthe - dimensi on al b al l . Wede 336 nethe op tim al m an if ol ddimensi on al itytobethedimensi on al itywhichm ax imizes Al th ou gh thesc or ew as m ot iv at edbythe Hau sd or an dGr om ov - Hau sd or dist an cesbetweenmetricsp ac es , doesn ot inv ol ve an yse ar choverm ap pin gs betweensp ac es ; r at her , weusethec an did at em ap pin gs providedbyMI ND . To displayinFi g. 2b , wesc al ethesc or esf or e ac hd at as ettor an ge fr om 0 to 1, sincewe ar e on lyinterestedinthev al ue of rel at ivetothem ax imum . In ou rtests , m an ydet ai ls of thede 336 niti on of c ou ldbech an ge d , includingch an gi ngthepercentiles , or repl ac ingthembytheme an or medi an , with ou tch an gi ngthe op tim al dimensi on al ityestim at es . . . gf : RN & Rdgr : Rd & RNh = gr * gf : RN & RNx ! RN 367 x = hx ! RNxx under s { xt } { 367 xt } 265 { xt } s 1 { % xt # 367 xt % 2 } s 2 { % xt # 265 % 2 } , where % xxs =1 # s 1 s 2 llg train f : RN & Rdh train : RN & RNg train flh train y ! Rdx ! RNxi ! Rixixiyxixi 367 xi 10 . CC-BY-NC-ND 4.0 International license under a which was this version posted September 20, 2018. ; https://doi.org/10.1101/418939 doi: bioRxiv preprint therem ai ningcells , wec om putedabinned 336 ringr at ebyc on v ol vingitsspiketr ai nwithaG au ssi an kernelst an d ar ddevi at i on , 7 sec on ds , resultinginasmo ot hed , c on tinu ou s - timesi gn al whichwes am pled at ac on st an tr at etemp or al bin width, 05 sec on ds . Wec on c at en at edthe 336 ringr at esine ac htimebin ac r os scellstocre at ep op ul at i on ac tivityvect or s , whichwereusedin al lsubsequent an al yses . 3 Re co ns tr uct eda ct ivityve ct orsa nd re co ns tr uct ions co reInSecti on s 1. 5. 1 an d 1. 5. 2, wede 336 nedaf or w ar dm ap pingfr om st at esp ac etointrinsicm an if ol dco or din at es , an dareversem ap pingfr om intrinsicm an if ol dco or din at estost at esp ac e . Thec om p os iti on of thesetwom ap sde 336 nesa 322r ec on structi on m ap 323 . F or ac tivityvect or ,l etden ot ethec or resp on dingrec on structed ac tivityvect or . Thevect or 367 representstheim age of am ap pingfr om the ac tivityvect or stotherec on structedm an if ol d , viewed as asubsp ac e of ac tivitysp ac e . Therec on structi on sc or eshowninFi g. 2b , an dExtendedD at aFi gs . 1 an d 2 isde 336 ned as thefr ac ti on of v ar i an ceinthe ac tivityvect or sexpl ai nedbytherec on structed ac tivityvect or s . Speci 336 c al ly , ifwede 336 ne = me an = me an = me an % den ot estheEuclide an n or m of ,t hensis gi venbyToc om putethe ac tivityrec on structi on sshowninFi g. 3, weusedacr os s - v al id at edversi on of the ab oveprocedure . F or e ac htri al , wer an theMI ND al gor ithm on atr ai ningset , de 336 ned as theuni on of ac tivityvect or sn ot fr om tri al , ob t ai ningaf or w ar dm ap an darec on structi on m ap . We ap plied to the ac tivityvect or sfr om tri al thetestsettoproducealow - dimensi on al embedding of thenetw or ktraject or y on th at tri al as showninFi gs . 3d , 3e , t op , an dwe ap pliedtoproduceac or resp on dinghi gh - dimensi on al rec on structedtraject or y as showninFi gs . 3d , 3e , b ot t om , f or twoindividu al cellsc or resp on dingtotwoco or din at es of thehi gh - dimensi on al rec on structi on . Thesc or es as soci at edwiththeserec on structi on s , as showninFi g. 3c , ar ede 336 nedinSecti on 13. 4 Ma ni fold 336r i ng 336e l ds Weusethetermin ol ogy 322m an if ol d 336 ring 336 eld 323 torefertothe ac tivity of a gi vencell , viewed as afuncti on of intrinsicm an if ol dco or din at es . M an if ol d 336 ring 336 eldsweredepictedin on e of twoways . Le tden ot etheintrinsicm an if ol dco or din at es of ap ar ticul ar hi gh - dimensi on al st at e , an dletden ot ethev al ue of thethco or din at e of , i . e . , the ac tivity of cellinth at st at e . InFi g. 2e SMT as well as ExtendedD at aFi gs . 6 an d 7, wedepictm an if ol d 336 ring 336 eldssimplybyvisu al izing as afuncti on of . F or ai d of visu al iz at i on , on lyl an dm ar kp oi nts ar eshownseeSecti on 1. 6. 3 . InFi g. 2e RFT , isvisu al ized as afuncti on of thethe 336 rsttwom an if ol dco or din at es or deredbyv ar i an ce . InExtendedD at aFi gs . 6 an d 7, al lco or din at es ar eshown . InFi gs . 3d an d 3e , m an if ol d 336 ring 336 elds ar eme an ttoindic at ethe ac tivityrec on structedfr om them an if ol d . Theref or e , these 336 elds ar en ot gi venbye ac hcell 325 strue ac tivityv al ues , butr at heritsrec on structed ac tivityv al uesseeSecti on 3 . Intuitively , these 322r ec on structed 323 m an if ol d 336 ring 336 eldsrepresentthe ac tivity of e ac hcellprojected on t o, or smo ot hed al on g, them an if ol d . Whentherec on structi on is ac cur at e , these 336 eldswillcl os ely ap proxim at ethe 336 eldsc om putedbythe 336 rstprocedure ab ove . Z = { 1 T } $ Nq 265 C = WW T + % 2 IWNqI % 2 CN # q % 2 " ; Z # TN 2 # T 2 # 1 2 Tizi # 265 TC $ 1 zi # 265 Z : 265 ML = 1 TTizi { # 1 # N } Z { 1 N } N # q % 2 ML = 1 N # qNiq +1 # i $ q # 1 # qUq =[ u 1 qqC ML = % 2 ML I + Uq $ q # % 2 ML IUTqqq ' =0 . q + , - k . . . . . . ki # i ' Nj =1 # j / 0 1 qqp Z| q 14 15 # 15 15 # 15 9 . CC-BY-NC-ND 4.0 International license under a which was this version posted September 20, 2018. ; https://doi.org/10.1101/418939 doi: bioRxiv preprint Le tz ,. .., zRden ot easet of ge nericd at ap oi nts . Givenaspeci 336 eddimensi on al ity ,P PCAmodelsthed at awithaG au ssi an distributi on withme an an dcov ar i an cem at rix ,w here is am at rix , istheidentitym at rix , an disthen oi sev ar i an ce . Thisexpressi on f or c on str ai nsthev ar i an ce al on ge ac h of thesm al lestdirecti on stoequ al . Thel og likelihoodisgivenby : 265, Cl og 2 & l og detC 15 =1 Them ax imumlikelihoodPPCAp ar am etershavecl os ed - f or mexpressi on sth at c an bec om putedfr om an ei ge ndec om - p os iti on of thes am plecov ar i an cem at rix . Theme an isequ al tothes am pleme an of =1 16 Le t ,. .., den ot etheei ge nv al ues of thes am plecov ar i an cem at rix of indescending or derwithc or resp on dingei ge nvect or su ,. .., u . Them ax imumlikelihoodn oi sev ar i an ceisequ al totheaver age of thesm al lestei ge nv al ues : = 17 Le t = di ,. .., an du 1 ,. .., u ] c on t ai nthet op ei ge nv al ues an dei ge nvect or s of thes am plecov ar i an cem at rix . Them ax imumlikelihoodcov ar i an cem at rixis : 18 Thedimensi on al ityisahyperp ar am eter , wh os ev al uec an beselectedb as ed on thed at a. Asep ar at ev al ueisselectedf or e ac hloc al set of p oi nts on whichPPCAisrun . In ou r an al yses , wech os e as theminimumnumber of dimensi on sc on t ai ningfr ac ti on 95 of thet ot al v ar i an ce : =m in =1 19 c an al sobech os enusingBayesi an modelselecti on . Inthisc as e , isselectedtom ax imizetheevidence , f or whi ch gi ves an e ! cientlyc om put ab le , cl os edf or m ap proxim at i on . 2 Data pr o ce ssi ng An al yseswereperf or med on asubset of thed at ac ol lectedin . F or e ac ht as kRFT , SMT , weselected 3 behavi or al sessi on sto an al yze , fr om 3 dierentr at s . Individu al sessi on swerech os entom ax imizethenumber of simult an e ou slyrec or dedcells , af terth os ewithveryhi gh or low 336 ringr at eswereremoved , as describedinthef ol lowingp ar agr ap hcellc ou nt af terremov al , RFTsessi on s 52, 20, 41 f or r at s 103, 107, 108; SMTsessi on s 42, 15, 23 f or r at s 103, 106, 107 . Af ter ob t ai ningspiketr ai nsprocessed as in , weperf or medthef ol lowing ad diti on al procedures . F or e ac hSMTsessi on , weremoved al lspikeswhichoccurredduringtheinter - tri al interv al as de 336 nedin , restricting ou r an al ysesto ac tivityfr om thetri al p or ti on of thet as k . Wethende 336 nedp op ul at i on ac tivityvect or sf or e ac hbehavi or al sessi on viathef ol lowingsteps . We 336 rstremovedcellswithme an 336 ringr at elessth an . 05 Hz or gr e at erth an 5 Hz . Thepurp os e of the 336 rstthresh ol dw as torejectSMTcellsth at h ad no ac tivityduringthetri al - p or ti on of t as kwhichwerethe on lycellsremoved , f or thesimplicity of implementing ou r an al ysesincludingthesecellsw ou ldn ot haveaectedtheresults of thep ap er . Thepurp os e of thesec on dthresh ol dw as toremoveput at iveinterneur on s . F or e ac h of N 12 TOT 2 OTT + T | E | E | O iT 2 i 13 . T ! ' TT ! 5 e 13 1 8 . CC-BY-NC-ND 4.0 International license under a which was this version posted September 20, 2018. ; https://doi.org/10.1101/418939 doi: bioRxiv preprint inSecti on 1. 5 inv ol vesp ai rwisedist an cec om put at i on swh os eruntimesc al esline ar lywith . Ins om ec as es , dimen - si on al ityreducti on may gi vethe ad diti on al bene 336 t of den oi singthed at a. Not eth at , whenPCApreprocessingisused , them ap pin gs described ab oveSecti on 1. 5 rel at ec om p on entsc or estom an if ol dco or din at es . Inthisc as e , rawneur al ac tivityc an e as ilyberel at edtom an if ol dco or din at esbytr an sf or mingraw ac tivitytoc om p on entsc or es an dviceversausingthesimplef or w ar d an dreversem ap pin gs providedbyPC A. 1. 6. 2 Acceler at ingPPCAf or esttr ai ningTr ai ningthePPCAf or estrequires 336 ttingmultipleloc al PPCAmodels . Anodeissplit at e ac hstep of 336 tting an individu al decisi on tree , whichrequiresselectingasplittingdirecti on an dthresh ol dfr om aset of c an did at ev al ues . Thedirecti on an dthresh ol d ar ech os entom ax imizethelikelihood of thePPCAmodelsf or thechildnodescre at edbythesplit . Thisrequires 336 ttingtwoPPCAmodelsf or e ac hp os siblech oi ce of splittingdirecti on an dthresh ol d . Givenasplittingdirecti on , an exh au stivesearchoverthresh ol dsmaybec om put at i on al lypr oh ibitive . Tospeeduptr ai nin g, asm al lerset of thresh ol dsc an betestedinste ad . F or ex am ple , weimplementedthef ol lowingprocedure . Givenac an did at esplittingdirecti on , thebestthresh ol disselectedfr om asm al lnumber of c an did at ese . g. 10 or 20 th at dividethed at aintoevenqu an tiles al on gthe gi vendirecti on . G ol densecti on se ar chisthenusedto op timizethethresh ol d , st ar tingfr om thisiniti al v al ue . Al tern at ively , tospeeduptr ai ningevenfurther , weusethef ol lowing ap proxim at i on procedure . Givenasplittingdirecti on , thethresh ol disch os ensuchth at theme an success or st at ef or e ac hchildnodebestpredictsthe ac tu al success or st at es , as me as uredbythesqu ar ederr or . Thisisequiv al enttom ax imizingthelikelihood , as sumingth at thedistributi on oversuccess or st at esf or e ac hchildnodeis an is ot r op icG au ssi an distributi on . Thisoptimiz at i on pr ob lemdoesn ot requireestim at ing or dec om p os ingcov ar i an cem at rices , an dc an bes ol vede ! cientlyusingrunningsumstoupd at etheerr or f or e ac hch oi ce of thresh ol d , r at herth an rec om putingitfr om scr at ch . Oncethethresh ol dh as beench os en , fullPPCAmodels ar ethen 336 ttothesuccess or st at esf or e ac hchildnode . Thisprocedureisrepe at edf or e ac hc an did at esplittingdirecti on , an dthe 336 n al directi on an dthresh ol d ar ech os entom ax imizethelikelihood of thePPCAmodels . Theref or e , on lyasin gl ePPCA 336 tperdirecti on isrequired . 1. 6. 3 L an dm ar kappr oac hOncetr an siti on pr ob ab ilitieshavebeenestim at ed , le ar ningthem an if ol dstructure as described ab oveinv ol vesc om pu - t at i on s on dist an cesbetween al lp ai rs of netw or kst at esinthed at as et . F or timep oi nts , thisrequiresmem or y . C om puting ge odesicdist an cesusingJ oh ns on 325 s al gor ithmh as timec om plexityl og where | den ot esthenumber of p ai rs of netw or kst at eswithn on zerotr an siti on pr ob ab ility . Findingm an if ol dco or din at esusingS am m on m ap pingh as timec om plexitywhereden ot esthenumber of iter at i on s . Theserequirementsc an bec om einfe as iblef or d at as etswithm an ytimep oi nts . Toen ab lem an if ol ddiscoverywithl ar ge d at as ets , weemploya 324 l an dm ar k ap pr oac h 325 simil ar toth at describedinThePPCAf or estis 336 tusingthefulld at as et . There af ter , dist an ces ar ec om putedbetweenarepresent at ivesubset of st at esc al led 324 l an dm ar kp oi nts 325 , which ar eusedtole ar nthem an if ol dstructure . Thus , c om put at i on al c om plexitydepends on ly on thenumber of l an dm ar kp oi nts . In ou r an al yses , weused = 2000, al lowingdist an cec om put at i on s an dm an if ol dle ar ninginjustafewminutes on st an d ar dh ar dw ar e . Weselectedl an dm ar kp oi nts as themed oi ds ob t ai nedviak - med oi dsclustering of al lst at esinthed at as etusingEuclide an dist an cesbetweenst at es . F or veryl ar ge d at as ets , l an dm ar kp oi ntsc ou ldinste ad bech os enusing an ! cient , gr eedy al gor ithmdescribedin . Us ingthel an dm ar k ap pr oac h , intrinsicm an if ol dco or din at es ar e ob t ai nedf or e ac hl an dm ar kp oi nt . To ob t ai nfulltraject or ies on them an if ol d , al lst at esc an thenbem ap ped on tothem an if ol dusingthef or w ar dm ap pingdescribed ab oveSecti on 1. 5 . 1 . 7 Pro ba bi listicPCAPr ob ab ilisticPCAPPCAisapr ob ab ilisticv ar i an t of cl as sic al PC A, f or mul at ed as aG au ssi an l at entv ar i ab lemodel . Weuseit as ame an sto 336 taG au ssi an distributi on withlow - dimensi on al c on str ai nts on thecov ar i an cem at rix 321t h at is , thev ar i an ce al on gm an ydirecti on ssh ou ldbesm al l . wxw * * * * * x # kiwi ! ix * * * * * 2 + # w % 2 kj =1 wi =1 11 GG ij x # ! ix 341 x # ! jxI $ G + # Iw = $ 1 x { ! ! 1 x ! ! kx } $ Y . gfxkiwix ! ! ixk # X = { x 1 T } $ NY = { y 1 T } $ dgr : Rd & RNgryixiiXYy on kygryk # # NNON 3 7 . CC-BY-NC-ND 4.0 International license under a which was this version posted September 20, 2018. ; https://doi.org/10.1101/418939 doi: bioRxiv preprint = ar gm in =1 % 11 s.t . An e ! cientlyc om put ab le , cl os edf or ms ol uti on tothis op timiz at i on pr ob lemisdescribedin . Le tden ot etheloc al Gr am m at rix : 12 Le tden ot etheidentitym at rix an d 1 den ot eavect or of on es . The op tim al wei gh tsc an bef ou ndbys ol vingthef ol lowingequ at i on an dthenresc al ingthewei gh tssoth at theysumto on e . 13 isthenm ap ped on tothem an if ol dby ap plyingthes am ewei gh tstotheknownim age s of itsnei gh b or s on them an if ol d ,. .., =1 14 Thenumber of nei gh b or s an dthere gu l ar iz at i on stren gt h ar ehyperp ar am eters , an dc an bech os enusingcr os s - v al id at i on on the or i gi n al d at as etwhereco or din at esinst at esp ac e an d on them an if ol d ar eb ot hknown . In ou r an al yses , weused 10- f ol dcr os s - v al id at i on . 1. 5. 2 Reversem ap pingAsimil ar ap pr oac hc an beusedto ob t ai n an explicitm ap pingfr om them an if ol db ac ktost at esp ac e . Thereversem ap ping gi vesthec or resp on dingp at tern of neur al ac tivityf or an yp oi nt on them an if ol d . As ab ove , wetre at this as asupervisedle ar ningpr ob lem : Givenst at es ,. .., xRwithc or resp on dingm an if ol dco or din at es ,. .., yR , le ar nam ap pingsuchth at ap proxim at esf or al l . Then on p ar am etricre gr essi on methoddescribed ab ovec an beusedhere , byreversingther ol es of an d : 1 Givenanewp oi ntthem an if ol d , 336 nditsne ar estnei gh b or sinthetr ai ningset . 2 Findthe op tim al wei gh tsth at ap proxim at e as aline ar c om bin at i on of itsnei gh b or s . 3 Obt ai nby ap plyingthes am ewei gh tstotheknownco or din at es of thenei gh b or sinst at esp ac e . As ab ove , thehyperp ar am eters an dc an beselectedusingcr os s - v al id at i on . The op tim al hyperp ar am eterv al uesf or thef or w ar d an dreversem ap pin gs will ge ner al lydier . 1 . 6 Com put atio na l co ns i de ratio ns 1. 6. 1 PreprocessingwithPCAThed at ac an bepreprocessedusingprincip al c om p on ent an al ysisPCAtoreduceitsdimensi on al ity , therebyspeedingupfurtherc om put at i on s . Inthisc as e , thenetw or kst at esdescribed ab oveSecti on 1. 1 representthec om p on entsc or es at e ac htimep oi nt , r at herth an theraw ac tivities of neur on s . The am bientdimensi on al ity of st at esp ac ethenc or resp on dstothenumber of c om p on ents . WeusedPCApreprocessingin ou r an al yses , an dch os e to pre se rv e at le as t 95% of thev ar i an ce of therawneur al ac tivity . This gi vesalower - dimensi on al line ar subsp ac einwhichan on line ar m an if ol d of evenlowerintrinsicdimensi on al ityisembedded , with ou tdisc ar dingmuchinf or m at i on . Dimensi on al ityreducti on decre as esthetimeneededtoestim at etr an siti on pr ob ab ilities , an dtoev al u at em ap pin gs betweenst at esp ac e an dthem an if ol d . F or ex am ple , 336 ttingthePPCAf or estrequiresmultipleei ge nv al uedec om p os i - ti on s of cov ar i an cem at rices , e ac hrequiringtime . Ev al u at ingthen on p ar am etricre gr essi on modelsdescribedD ij = 1 2 ! DG ij + DG ji " Dd { 1 T } $ dy 1 ,...,y TTiTj = i 1 D ij D ij #% yi # yj % 2 9 10 321 1 D ij 6 ddN 10 X = { 1 T } $ NY = { 1 T } $ dgf : RN & Rdgfxiyii . ! 11 xk { ! 1 x ! kx } $ Xxwx " 2 x 6 . CC-BY-NC-ND 4.0 International license under a which was this version posted September 20, 2018. ; https://doi.org/10.1101/418939 doi: bioRxiv preprint Geodesicdist an ceswerethensymmetrizedto gi vethe 336 n al , gl ob al dist an ce : 9 1 . 4 Lear ni ng intri ns icma ni fold co or di na tesP oi nts on them an if ol dc an beindexedbyaset of low - dimensi on al co or din at es . Intrinsicm an if ol dco or din at eswere ob t ai nedf or ob servednetw or kst at esbyembeddingthemintoavect or sp ac esuchth at dist an ces on them an if ol dwere ap proxim at elypreserved . Givenp ai rwisedist an cem at rix as estim at ed ab ove , - dimensi on al intrinsicco or din at esy ,. .., yRwere ob t ai nedf or e ac hd at ap oi ntbys ol vingthef ol lowing op timiz at i on pr ob lem : mi n =1 +1 10 Thispr ob lemc or resp on dstoS am m on m ap ping 321a f or m of n on cl as sic al , metricmultidimensi on al sc al ingMDSusing ou rnoveldist an ceme as ureth at c ap turesstructureindyn am ics . In 10 , weseekembeddingco or din at essuchth at Euclide an dist an cesintheembeddingsp ac ebestm at chthe gi vendist an cesinthele as tsqu ar essense . Thewei gh t te rm pl ac es gr e at eremph as is on preservingdist an cesbetweenp oi ntsth at ar ene ar by on them an if ol d . Thisch oi cere 337 ectstheimp or t an ce of loc al dist an ces , inth at : 1 Lo c al dist an ces ar edirectlyc om putedfr om estim at edtr an siti on pr ob ab ilities , where as gl ob al dist an ces ar ederivedfr om them ; an d 2 Lo c al dist an ces ar e of prim ar yrelev an cetorecoveringtheloc al t op ol ogy of them an if ol d . Ho wever , thef ac tth at gl ob al dist an cesdoc on tributetotheembeddingmayprovider ob ustnessoverpurelyloc al embeddingtechniques . Thedimensi on al ityisahyperp ar am eter , an dc an beselectedusingthemethoddescribedinSecti on 6. Wes ol ved 10 usingthec on ju gat e gr ad ientmethod . The op timiz at i on w as initi al izedwiththe - dimensi on al cl as sic al MDSs ol uti on f or dist an cem at rix , whichc an bec as t as an ei ge npr ob lem an ds ol vedincl os edf or m . Thes ol uti on to 10 is on lyspeci 336 eduptori gi dtr an sf or m at i on s . To ob t ai nac an on ic al represent at i on , weusedPCAtocenter an dr ot at ethes ol uti on with ou tdisc ar ding an ydimensi on s . Thisensuredth at theresultingm an if ol dco or din at es of thed at awereunc or rel at ed , al i gn edwiththedirecti on s of gr e at estv ar i an ce , an d or deredbydecre as ingv ar i an ce . 1 . 5 Ma ppi ng sbetweenstates pa ce a nd t he ma ni fold 1. 5. 1 F or w ar dm ap pingThe ab oveprocedureSecti on 1. 4 producesintrinsicco or din at es on them an if ol df or e ac hnetw or kst at einthed at as et . Ho wever , itis al sousefultohave an explicitm ap pingfr om st at esp ac etothem an if ol d , soth at m an if ol dco or din at esc an al sobe ob t ai nedf or ou t - of - s am pled at ath at ar en ot presentinthetr ai ningset . Wetre at this as asupervisedle ar ningpr ob lem : Givenst at esx ,. .., xRwithc or resp on dingm an if ol dco or din at esy ,. .., yR , le ar nam ap pingsuchth at ap proxim at esf or al lInprinciple , an ysucientlypowerful , n on line ar re gr essi on methodwithmultidimensi on al ou tputsc ou ldbeusedf or thispurp os e . Weusedan on p ar am etricre gr essi on method or i gi n al lypr op os edf or usewithloc al lyline ar embedding LLE . Tom ap anewp oi ntinst at esp ac e on tothem an if ol d , itsne ar estnei gh b or s ,. .., ar ef ou nd , as me as uredbyEuclide an dist an ceinst at esp ac e . isthenexpressed as awei gh tedsum of itsnei gh b or s . Wei gh ts ar ef ou ndth at minimizethesqu ar edrec on structi on err or plus an re gu l ar iz at i on termth at enc ou r age ssm al lwei gh ts . Wei gh ts ar ec on str ai nedtosumto on e , whichm ak estheminv ar i an ttotr an sl at i on of an ditsnei gh b or sthey ar e al soinv ar i an ttor ot at i on an dsc al ing . SS 6 # PP ij xi to xj : P ij = pXt +1 = xj | Xt = xi % nk =1 pXt +1 = xk | Xt = xi where PXt | Xtxiyi # yi to yjpYt +1 = yj | Yt = yi 1 Zi exp & # D # ij 2 ' where D # ij yi to yjZiZiP ij D # ij = # P ij D # 7 GijD # ij i to jijDG ij Gij 8 5 . CC-BY-NC-ND 4.0 International license under a which was this version posted September 20, 2018. ; https://doi.org/10.1101/418939 doi: bioRxiv preprint as c om put at i on al lyfe as ible . Ho wever , perf or m an ceeventu al ly as ympt ot es , sothereislittleadditi on al bene 336 ttoincre as ingbey on dacert ai np oi nt . In ou r an al yses , weused = 100. 1 . 3 Meas ur i ng di sta nce between ne tworkstatesThemodel of st at etr an siti on sle ar nedinSecti on 1. 2 w as usedtoc on structadist an ceme as urebetweenst at es . Dist an cesbetweenp oi nts on alow - dimensi on al m an if ol dc an beusedtoestim at e ge om etric an dt op ol ogi c al pr op erties of them an if ol d , an dtom ap p oi ntstolow - dimensi on al , intrinsicco or din at es on them an if ol d . Thech oi ce of dist an ceme as ureplays an imp or t an tr ol einestim at ingthesequ an titiesfr om thed at a. M an if ol dle ar ning al gor ithms ar e of tenb as ed on prede 336 neddist an ceme as uresininputsp ac ee . g. Euclide an dist an ce . In ou r ap plic at i on , thisw ou ldc or resp on dtoc om p ar ingthe 336 ringr at es of e ac hneur on indierentst at es . Ho wever , itisuncle ar ap riorihowtome as urethesimil ar ity of 336 ringr at esinawayth at re 337 ectstheirme an ing or in 337 uence on thenetw or k . Inste ad , wes ou gh ttole ar ndist an cesfr om thebehavi or of thenetw or kitself . Wede 336 nedanoveldist an ceme as ureb as ed on tr an siti on pr ob ab ilities , whichc ap turesstructureinthedyn am ics of thesystem . F or ex am ple , twost at es ar e as si gn edasm al ldist an ceifthenetw or ktr an siti on sdirectlybetweenthemwithhi gh pr ob ab ility , an dal ar ge dist an ceifthenetw or k on lytr an siti on sbetweenthembymovingthr ou gh m an yintermedi at est at es . Thisn ot i on of dist an ceis agn os tictothen at ure of thest at es , an dme as ures on lyhowthenetw or ktr an siti on sbetweenthem . Ourdist an ceme as ureisb as ed on ar r an gi ngp oi nts on am an if ol dsuchth at thetr an siti on pr ob ab ilities of ar an d om w al k on them an if ol dm at chth os eestim at edfr om thed at a. 1. 3. 1 Loc al dist an cesThePPCAf or estmodelstr an siti on sovertheentire , c on tinu ou sst at esp ac e . Restrictingtr an siti on stost at esinthed at as et gi vesadiscrete ap proxim at i on tothisprocess , c ap turedbystoch as ticm at rix . Le tden ot ethepr ob ab ility of tr an siti on ingfr om st at e 6 +1 den ot esthePPCAf or est ou tput . Supp os ee ac hst at einthed at as eth as an im age on am an if ol d . C on siderar an domw al kth at traversesthesep oi nts , ac ting as adiscretediusi on process on them an if ol d . Thepr ob ab ility of tr an siti on ingfr om c an be ap proxim at edby an is ot r op icG au ssi an kernelfuncti on : 7 den ot esloc al dist an ce on them an if ol dfr om an disan or m al izingc on st an tsuchth at tr an siti on pr ob ab ilitiessumto on e . F or c on venience , we as sume = 1, as dist an cesc an be ad justedtoc om pens at e . As sumetr an siti on pr ob ab ilities of ther an d om w al k ar eequ al toth os eestim at edfr om thed at a. Settingr an d om w al ktr an siti on pr ob ab ilitiesto an ds ol vingf or dist an ces gi ves : l og 8 1. 3. 2 Gl ob al dist an cesWhenc al cul at ed as in 8 , me as ureside al lo caldist an ces on them an if ol d . Ho wever , itisin 336 nitewhentheestim at edtr an siti on pr ob ab ilitybetweenst at esiszer o, an disn ot symmetricunlessestim at edtr an siti on pr ob ab ilities ar esymmetric . Weusedloc al dist an cestode 336 nea gl ob al , symmetricdist an ceme as uresuit ab lef or m an if ol dle ar nin g. Simil ar tois om ap , wede 336 nedthe gl ob al dist an cebetweentwost at es as thelen gt h of thesh or testp at hfr om on etothe ot hervia an yintermedi at e , c on nectedst at es . C on sideradirected gr ap hwh os everticesc or resp on dtost at es . An ed ge fr om vertex to ve rte xexistswithwei gh tifthereisn on zeropr ob ab ility of tr an siti on ingfr om st at est at e . The gl ob al dist an cefr om st at etost at eis gi venby , the ge odesicdist an ce on fr om vertex to ve rte x . Geodesicdist an cesbetween al lp ai rs of st at eswerec om putedusingJ oh ns on 325 s al gor ithm . nn dir nnn 4 # nnn # 4 5 { f 1 S } Sxpx ! | x 1 Z # f 1 x ! | xSx ! | x $ ZZn dir n dir n dir n dir # n dir S . SS 4 . CC-BY-NC-ND 4.0 International license under a which was this version posted September 20, 2018. ; https://doi.org/10.1101/418939 doi: bioRxiv preprint on theunitsphere . Thisc on str ai ntintroducesr an d om nessintothe 336 ttingprocedure , whichdec or rel at estrees an dplays an imp or t an tr ol ewhenmultipletrees ar ec om binedinto an ensemblemodelSecti on 1. 2. 3 . Thesplittingthresh ol disc on str ai nedsuchth at nofewerth an l ea fd at ap oi nts ar e as si gn edtoeithersubre gi on . Ch oi ce of thehyperp ar am eters an dl ea f is discusse db elo w . The op timiz at i on pr ob lem 4 c an bes ol vedbyiter at ingthr ou gh directi on s an da 336 nitenumber of thresh ol dsth at uniquelyp ar titi on thed at a al on ge ac hdirecti on . PPCAmodels ar e 336 tf or e ac hc an did at edirecti on an dthresh ol d , an dthedirecti on , thresh ol d , an dPPCAp ar am etersth at m ax imizethel og likelihood ar eret ai ned . Wedescribewaysto ac celer at ethe op timiz at i on procedureinSecti on 1. 6. 2. In ge ner al m ac hinele ar ning ap plic at i on se . g. cl as si 336 c at i on , re gr essi on , an dne ar estnei gh b or se ar ch , decisi on treenodes ar ec om m on lysplit al on gsin gl edimensi on s . Thisc or resp on dstosplittingwith ax is - p ar al lelhyperpl an es , producinghyperrect an gu l ar loc al re gi on s . He re , weperf or msplits al on gr an d om ized , ob liquedirecti on s , producingloc al re gi on sth at ar ec on vexp ol yt op es . Thisstr at e gy al lowstreesto ad ap tm or ee ! cientlytod at adistributed al on glow - dimensi on al m an if ol ds , butembeddedinsp ac eswithhi gh am bientdimensi on . 2, 3 St op pingrulesdeterminewhentherecursivesplittingproceduretermin at es , producinga 336 n al le af node . Anodewilln ot besplitifitc on t ai nsfewerth an 2 nl ea fd at ap oi nts . T oge therwithc on str ai nts on thesplittingthresh ol d 4 , thisensuresth at everyle af nodeinthe 336 n al modelc on t ai ns at le as tl ea fd at ap oi nts . Simil ar tore gr essi on trees an dr an d om f or ests , 4, 5 decre as ingl ea fproducesal ar ge rnumber of sm al lernei gh b or hoods , whichincre as es 337 exibility of theover al lmodel an dreducesbi as . Ho wever , it al soleavesfewerd at ap oi ntsav ai l ab lef or 336 ttingloc al models , whichincre as esv ar i an ce . As inr an d om f or ests , thisc os tisosetbyc om biningthe ou tputs of m an ytrees , whichreducesv ar i an ce , thereby al lowingm or e 337 exibletreesseeSecti on 1. 2. 3 . A ge ner al gu idelineisth at l ea fmustbel ar ge en ou gh to al lowtheestim at i on of aloc al PPCAmodel . l ea fc an beselectedusingcr os s - v al id at i on . In ou r an al yses , weusedl ea f = 40, whichw as ch os enin an ad ho cm an ner , an dn ot op timizedusingthed at a. 1. 2. 3 C om biningtreesintoaf or estIndividu al trees ar ec om binedintoaf or est , whichis an ensemblemodel of tr an siti on sbetweennetw or kst at es . E ac htreerepresentsap ar titi on of st at esp ac eintoloc al nei gh b or hoods , withatr an siti on modelf or e ac hnei gh b or hood . Bec au senodesplittingdirecti on s ar ech os enfr om ar an d om set 4 , thenei gh b or hoods an dloc al models ar edierentf or e ac htree . Thisr an d om iz at i on servestodec or rel at etrees . As withr an d om f or ests an db aggi n g, c om biningthe ou tputs of adiverseset of modelsreducesv ar i an ce , yielding an ensemblemodelwith gr e at erperf or m an ceth an an yindividu al model . Le t ,. .., fden ot ethemodelsf or trees , e ac hspecifyingatr an siti on pr ob ab ilitydensityfuncti on as in 2 . Givencurrentst at e , thec om binedtr an siti on pr ob ab ilitydensityfuncti on is : medi an ,. .., f 5 Thes am plemedi an of theindividu al model ou tputsisusedf or r ob ustness . isan or m al izingc on st an tsuchth at thedistributi on inte gr at esto on e . Inpr ac tice , itisn ot necess ar ytoc om pute , as further an al yses on lyrequirev al uespr op or ti on al tothepr ob ab ilitydensity . Thede gr ee of dependencebetweentreesisc on tr ol ledbythehyperp ar am eter , whichspeci 336 esthenumber of r an d om directi on stoc on siderwhensplittinganode 4 . playsasimil ar r ol e as thehyperp ar am eterinr an d om f or eststh at go vernsthenumber of inputfe at urestoc on sider on e ac hsplit . 4, 5 An al ogou sly , incre as ing al lowsindividu al treesto 336 tbetterbycho os ingm or e op tim al splittingdirecti on s , whichdecre as esbi as . Ho wever , it al soincre as esc or rel at i on betweentrees , whichincre as esv ar i an ce 321i ntuitively , thebene 336 t of ensemblingisreduced as theindividu al modelsbec om elessdiverse . The op tim al setting of inv ol vesatr ad eobetweenthese op p os inge # ects , an dc an beestim at edusingcr os s - v al id at i on . In ou r an al yses , weused = 2, whichw as ch os enin an ad ho cm an ner , an dn ot op timizedusingthed at a. R an d om izedtrees ar e 336 tindependently , an dthemodelc om bin at i on procedureitselfdoesn 325 tinv ol ve an y 336 ttin g. Thus , as inr an d om f or ests , thereisnorisk of over 336 ttingbyincre as ingthenumber of trees 4, 5 R at her , incre as ingservestodecre as ev ar i an ce , therebyincre as ing ac cur ac y of theensemble . Theref or e , sh ou ldbeset as hi gh 265 iCiAifx ! | xx ! xfxfx ! | xNx ! | 265 l ,C l where lxxNx | 265 C . ! 1 X + i = { xt | xt ! Ai } Ai 265 iCiX + iiAiAivcL + iR + iL + i { xt | xt ! Ai ,x t 341 v " c } R + i { xt | xt ! Ai ,x t 341 } " ML 341 vicivi ,c iv " Vi ,c " ML ! L + i " + " ML ! R + i " Vin dir <N 3 . CC-BY-NC-ND 4.0 International license under a which was this version posted September 20, 2018. ; https://doi.org/10.1101/418939 doi: bioRxiv preprint E ac hle af nodeh as an as soci at edG au ssi an distributi on withme an an dcov ar i an cem at rix ,w hichmodelsthedistributi on oversuccess or st at es , gi venth at thecurrentst at ef al lswithin . As awh ol e , thedecisi on treeimplements an estim at edtr an siti on pr ob ab ilitydensityfuncti on , which as si gn sapr ob ab ilitydensitytop os siblesuccess or st at e , gi vencurrentst at e . isc om putedbytraversingthetreeto 336 ndthele af nodec on t ai ning . Interms of thisle af node , theestim at edtr an siti on pr ob ab ilitydensityfuncti on is gi venbyxx 2 istheindex of thele af nodec on t ai ning , an d 265, Cden ot esaG au ssi an densityfuncti on withme an an dcov ar i an cem at rix 1. 2. 2 Fittingdecisi on treesAdecisi on treeisle ar nedbyrecursivelyp ar titi on ingst at esp ac eintopr ogr essively 336 nernei gh b or hoods . Atreebe gi ns as asin gl ele af nodethero ot representingtheentirest at esp ac e . Ate ac hstep , aleafnodeissplittocre at etwochildnodes , an daloc al modelis 336 ttothesuccess or s of st at esinthed at as etth at f al lwithine ac hchildre gi on . Splittingp ar am eters an dloc al models ar ej oi ntly op timized , suchth at loc al nei gh b or hoods ad ap ttothed at a. Ho wever , r an d om c on str ai nts ar eimp os ed , whichservetodec or rel at ethetrees an dincre as ethe ac cur ac y of the 336 n al ensemblemodel . Thetr ai ningprocedurec an beseen as ar an d om ized , gr eedy al gor ithmf or ap proxim at elym ax imizingthelikelihood of e ac htree . Le ar ningloc al distributi on swithpr ob ab ilisticPCA . Thedistributi on oversuccess or st at esf or e ac hnei gh - b or hoodismodeled as aG au ssi an , wh os eme an an dcov ar i an cem at rixmustbeestim at edfr om thed at a. Thetraject or ythr ou gh st at esp ac eisbelievedtoliene ar alow - dimensi on al , n on line ar m an if ol d . Thisimpliesth at thedistributi on overst at esinasucientlysm al lre gi on sh ou ldbec on centr at edne ar theloc al t an ge ntpl an e of them an if ol dwithsm al l ou t - of - pl an edevi at i on sdueton oi se an dthecurv at ure of them an if ol d . V ar i an cesh ou ldtheref or ebelow al on gdirecti on s or th ogon al tothet an ge ntpl an e . Toexpl oi tthislow - dimensi on al structure , pr ob ab ilisticPCAPPCAisusedtoestim at ethedistributi on oversuccess or st at es . PPCAprovidesre gu l ar iz at i on byimp os inglow - dimensi on al c on str ai nts on thecov ar i an cem at rix , therebyreducingover 336 ttin g. Le t +1 den ot ethesetc on t ai ningthesuccess or s of st at esinthed at as etth at f al lwithinnei gh b or hood . Theme an an dcov ar i an cem at rix ar eestim at edfr om usingm ax imumlikelihoodPPC A, as describedbelowSecti on 1. 7 . Spl itti ng rul e s. Splittinganodecre at estwochildnodes , e ac hwithaloc al PPCAmodel . Splittingp ar am etersdeterminethed at a as si gn edtoe ac hchildnode , an d ar ech os entom ax imizethelikelihood of theresultingPPCA mo del s. P ar am etersf or splittingnodec on sist of adirecti on an dthresh ol dth at de 336 neahyperpl an esep ar at ingtheloc al nei gh b or hoodintotwosubre gi on s 1 . Supp os eth at weresplit al on gdirecti on withthresh ol d . Le tsets v, c an d v, cc on t ai nthesuccess or s of st at esinthed at as etth at f al lwithintheresultingleft an dri gh tsubre gi on s . v, c +1 v, c +1 v> c 3 PPCAmodels ar e 336 ttoe ac h of thesesetsseeSecti on 1. 7 . Le tden ot ethel og likelihood of them ax imumlikelihoodPPCAmodelf or a gi venset of p oi nts , c om puted as in 15 . Thesplittingdirecti on an dthresh ol d ar ech os en as : = ar gm ax v, c v, c 4 Thesplittingdirecti on isc on str ai nedto , aset of r an d om directi on ss am pledfr om theunif or mdistributi on 16 18 NX = { x 1 T } xt ! RNNt . XttXt +1 Xt is pXt +1 | Xt ! ! RN , pXt = x ! | Xt = xtpx ! | x 1 4 5 AiiviciAiALARLiRiAL = { x ! Ai | x 341 vi " ci } AR = { x ! Ai | x 341 vi >c i } xx is 2 . CC-BY-NC-ND 4.0 International license under a which was this version posted September 20, 2018. ; https://doi.org/10.1101/418939 doi: bioRxiv preprint 17 Devi at i on an al ysis 17. 1 Predictingbehavi or fr om m an if ol dco or din at es . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 16 17. 2 C om p ar is on toP oi ss on model . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 16 17. 3 Lag estim at i on . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 17 17. 4 Lag distributi on . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 17 17. 5 Si gn i 336 c an tle ad s & l ags . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 17 17. 6 Det ou rdetecti on . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 17 17. 7 An al ysis of m an if ol drec on structi on err or . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 18 18 C om p ar is on toPCA an dis om ap 1 Ma ni fold di s co very 1 . 1 I nput sInputc on sists of p op ul at i on ac tivityovertime , an dex oge n ou sbehavi or al v ar i ab les ar en ot used . Ac tivityf or ap op ul at i on of neur on sis gi ven as atimeseries of netw or kst at es ,. .., xwheree ac hst at eis an - dimensi on al vect or inac on tinu ou sst at esp ac e , withe ac hdimensi on representingthe ac tivity of aneur on at time 1 . 2 Mo de li ng statetra ns itio ns us i ng PPCAforestsApr ob ab ilisticmodel of tr an siti on sbetweenst at esisthenle ar ned . Le tbeac on tinu ou sr an d om vect or representingthest at e at time , an dletrepresentits 322s uccess or st at e , 323 thest at e on etimestepl at er . Thec on diti on al distributi on oversuccess or st at es gi vencurrentst at e , an dis as sumedn ot todepend on time . Theref or e , f or st at es x, x +1 isthes am ef or al l , an dwewillwritethis as as f or c on venience . Werefertothis as thetr an siti on pr ob ab ilitydensityfuncti on . Thetr an siti on pr ob ab ilitydensityfuncti on isestim at edusinganovel al gor ithmth at employsdecisi on treesto ad ap tivelyp ar titi on st at esp ac eintoloc al nei gh b or hoods , an dpr ob ab ilisticPCAtomodelthedistributi on oversuc - cess or st at esf or e ac hnei gh b or hood . Distributi on sfr om al ar ge set of r an d om izedtrees ar ethenc om binedto gi ve an ensemblemodelwithbetterperf or m an ceth an an ysin gl etree . This al gor ithm , whichwec al l 324 PPCAf or ests 325 , c om bineside as fr om pr ob ab ilisticPC A, r an d om projecti on trees , 2, 3 an dr an d om f or ests . 1. 2. 1 Modelingst at etr an siti on susingdecisi on treesDecisi on trees ar eusedtomodelthec on diti on al distributi on oversuccess or st at es , gi venthecurrentst at e . Inthis ap pr oac h , st at esp ac eisp ar titi on edintoloc al nei gh b or hoods , withaloc al distributi on oversuccess or st at esf or currentst at esth at lieine ac hnei gh b or hood . Thisstr at e gy issimil ar totree - b as edre gr essi on methods , but op er at esin an unsupervisedm an nerthere ar enoex oge n ou st ar ge tv ar i ab les , an dproducespr ob ab ilitydistributi on s as ou tputsr at herth an p oi ntestim at es . Adecisi on treerepresentsahier ar chic al p ar titi on of st at esp ac e , wheree ac hnode of thetreec or resp on dstoaloc al re gi on of st at esp ac ewhereisthenodeindex . Thero ot noderepresentstheentiresp ac e . E ac hintern al nodeh as adirecti on p ar am eter an dthresh ol dp ar am eterth at de 336 neahyperpl an e . Thehyperpl an esplits in to subre gi on si an di , c or resp on dingtotheleft an dri gh tchildnodes an dnthetree . ii 1 Le af nodes , whichhavenochildren , representthe 336 nestp ar titi on of st at esp ac eintodisj oi ntsubre gi on s . Theindex of thele af nodec on t ai ningst at ec an bef ou ndbytraversingthedecisi on tree . St ar tingfr om thero ot node , recursively as si gn edtotheleft or ri gh tchildnode ac c or dingto 1 , untilhittingale af node . 2 9 10 10 11 11 12 12 13 13 14 14 15 15 ! 15 16 1 . CC-BY-NC-ND 4.0 International license under a which was this version posted September 20, 2018. ; https://doi.org/10.1101/418939 doi: bioRxiv preprint METH O DS Con ten ts 1 M an if ol ddiscovery 1. 1 Inputs . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 2 1. 2 Modelingst at etr an siti on susingPPCAf or ests . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 2 1. 2. 1 Modelingst at etr an siti on susingdecisi on trees . . . . . . . . . . . . . . . . . . . . . . . . . . . 2 1. 2. 2 Fittingdecisi on trees . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 3 1. 2. 3 C om biningtreesintoaf or est . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 4 1. 3 Me as uringdist an cebetweennetw or kst at es . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 5 1. 3. 1 Lo c al dist an ces . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 5 1. 3. 2 Gl ob al dist an ces . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 5 1. 4 Le ar ningintrinsicm an if ol dco or din at es . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 6 1. 5 M ap pin gs betweenst at esp ac e an dthem an if ol d . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 6 1. 5. 1 F or w ar dm ap ping . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 6 1. 5. 2 Reversem ap ping . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 7 1. 6 C om put at i on al c on sider at i on s . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 7 1. 6. 1 PreprocessingwithPCA . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 7 1. 6. 2 Ac celer at ingPPCAf or esttr ai ning . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 8 1. 6. 3 Lan dm ar k ap pr oac h . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 8 1. 7 Pr ob ab ilisticPCA . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 8 2 D at aprocessing 3 Rec on structed ac tivityvect or s an drec on structi on sc or e 4 M an if ol d 336 ring 336 elds 5 P oi ss on model an dbehavi or al 336 ring 336 elds 6 Intrinsicdimensi on al itysc or e 7 Peer - predicti on sc or e 8 Fieldst ab ilitypl ot s 9 Simul at edhi gh - dimensi on al pl ac ecells 10 Decodingme as uredbehavi or al v ar i ab les 11 An al yzingsin gl e - tri al ac tivityintheSMT 12 Qu an ti 336 c at i on of tri al - t o- tri al v ar i ab ility 13 Sin gl e - tri al rec on structi on sc or es 14 Noi sec or rel at i on s 15 Noi sec or rel at i on shues 16 Syntheticpl ac e an d gr idcelld at a 11 . CC-BY-NC-ND 4.0 International license under a which was this version posted September 20, 2018. ; https://doi.org/10.1101/418939 doi: bioRxiv preprint E xt endedD at aFi gu re 11: Le ge nd for tra je ctory vide o. Beha v ioral v ideo ex cerpt f or an R FT session rat 103 M ar k ers ov erlaid on eac h frame sho w the ra t325 s true p osition red and pr edi cted p osition green giv en the net w ork 325s lo cation on the manifold. The past 8 s of the real and deco ded b eha v ioral tra jectories are sho wn as red and green lines, resp ectiv ely . Th e follo wing annotations indicate dev iations fr om enco di ng the cur r en tp os i ti on, as des cr ib ed inFi g. 4. D ur i ng detour s , the gr een deco ded tr a jector yb ecomes whi te. D ur i ng l eads and lags, y ello w and blue mark ers app ear on b oth the real and deco ded tra j ectories, indicating the segmen ts where the deco ded tra j ectory is leading or lagging the real tra j ectory , resp ectiv ely . L eads and lags w ere detected by statistical co mparison to the P oisson n ull mo del, as in Fig. 4c. See M etho ds f or l ead , lag, and detour detection. Signi ! b -5 -4 -2 -1 0 1 3 4 5 -3 2 Density 0.00 0.05 0.10 0.15 -5 -4 -2 -1 0 1 3 4 5 -3 2 Density 0.00 0.05 0.20 0.25 0.15 0.10 a 0.793 s 0.535 261 0.001 s 0.585 s 0.294 261 0.001 s -5 -4 -2 -1 0 1 3 4 5 -3 2 0.0 0.2 0.4 0.6 0.8 1.0 Cumulative probability -5 -4 -2 -1 0 1 3 4 5 -3 2 0.0 0.2 0.4 0.6 0.8 1.0 Cumulative probability -5 -4 -2 -1 0 1 3 4 5 -3 2 0.000 0.004 0.008 0.012 Fraction of timepoints -5 -4 -2 -1 0 1 3 4 5 -3 2 0.00 0.01 0.02 0.03 Fraction of timepoints 0 15 20 45 60 0 4 8 12 16 20 Reconstruction Error 0 Reconstruction Error R = -0.05 [-0.12, 0.02] 0 10 20 30 40 50 5 10 0 15 20 25 Reconstruction Error R = 0.12 [0.06, 0.17] 0 1 2 3 4 5 0 4 8 12 16 20 Reconstruction Error 0 Reconstruction Error cdR = 0.10 [-0.01, 0.21] Rec onstr uc tion vs . dec o ding err or c an t leads & lags L ag distribution Rat 107 Rat 108 M ean absolut e lag: M ean absolut e lag: R eal da ta P oisson model 0 10 20 30 40 50 5 10 0 15 20 25 cm Reconstruction Error R = 0.12 [0.06, 0.17] 0 1 2 3 4 5 s 0 4 8 12 16 20 Reconstruction Error 0 Reconstruction Error c Rec onstr uc tion err or vs . lag a, Bottom b, 9 . CC-BY-NC-ND 4.0 International license under a which was this version posted September 20, 2018. ; https://doi.org/10.1101/418939 doi: bioRxiv preprint E xt endedD at aFi gu re 9: Exampl e of a mi ss ed 336el d on the 3d RF T mani fol d. Sho wn for r at 103. A 322mi ss ed323 pl ace 336el do ccur s when the rat runs through ac ell325s 336ring 336e ld in the en v ironmen t, but the cell f ails to 336re or 336res an un usually lo wn um b er of spik es The missed 336eld is ex plained by considering the net w ork 325s tra jectory on the 3d manifold rather than the rat325s tra jectory in the 2d en v ironmen t. As the rat mo v es thro ugh the place 336eld, the 3d neural tra jectory do dg es around the cell325s manifold 336ring 336eld along the 3rd dimension, suc h that the cell do es not 336re. Le ft ,E xampleoftwospatialtrajectorysegments , eachpassingthroughtheplace 336 eld . Theexpected 336 ring rate giv en p osition far rig ht how st h ea mplitudeofth ep lace 336 el da longeac hs patia lt rajectory ; th et rajectorie ss ampl et h ep lac e336 eld nearly eq ually . How ev er, the cell has a missed 336eld on Tra jectory 1, where the true 336ring rate is m uc hlow er than T ra jectory 2 ce nter Th us, the cell325s 2d place tuning cannot accoun t for the v ariable neural activit y . ,F orreference : thetrueactivityandexpected activ it y giv en p osition, ov er the en tire session, for cell 1. Le ft ,T he 3 dmanifold 336 ring 336 eldo fc ell 1 . Theintrinsicmanifoldcoordinates of a represen ta ti ve set of datap oin ts are plotted, outlining the manifold. P oin ts are colored by the 336ring rate of cell 1 at the corresp onding timep oin ts. The manifold is aligned to the en v ironmen tb elo wby scali ng , and then rotating the 336rst two co ordinates. Asv isualized, the place 336eld is appro xi ma te ly a 2d pro jection of the 3d manifold 336eld. Ri ght ,T he 3 dmanifold 336 ring 336 eldisvisualizedasan 322 iso 336 eld ; 323 the green isosurface is de 336 ne d as the lev el set of cell 1325s 336ring rate, with lev el eq ua l to half the max im um amplitude. N et w ork tra jectories are plottedintheintrinsic 3 dcoordinatesystem . Wh enprojectedontotheenvironmentbelow , bothtrajectoriesoverlaptheplace 336 eld . In 3d, T ra jectory 1 do dges around the manifold 336ring 336eld alo ng the 3rd dimension, whereas T ra jectory 2 passes through its cen ter. Th us, the in teraction b et w een net wo rk tra jector i es and 336ring 336elds on the 3d manifold accoun ts for the va riable neural activ it y . 100 400 700 0 15 0 15 ! eld ! ring ! ! ! Iso ! eld ! eld ! eld 10 0 20 cm max 0 12 de ! ! 0 7 12 0 1 2 3 4 5 6 0 7 1 2 3 4 5 6 abT rue ac tivit y Expec t ed ac tivit yg iv en position F ir ing RatHzRat 103, c ell 1 Ac tivit yvs . time V ariable c ell ac tivit y despit e similar spa tial tr ajec t ories P lac eT sec onds 3d manif old eld and tr ajec t ories M anif old r ing eld , c ell 1 S ca tt er plot P lac e 3d manif old 10 0 F ir ing ratHzTr ajec t or y star tTr ajec t or y 1 Tr ajec t or y 2 Ac tivit yvs . time , full session Tr ajec t or y 1 Tr ajec t or y 2 F ir ing ratHzT rue ac tivit yF ir ing r aa teHz Expec t ed ac tivit yg iv en position ned fr om plac eT sec onds 1 2 3 4 5 6 T sec onds C ell ac tivit y > .5 * max ac tivit y Manifold X Manifold Y 2nd half 1st half 20 15 15 15 10 10 10 8 1 4 1.5 0.6 3 1 2 F ield stabili tyxx and y # x or y 8 . CC-BY-NC-ND 4.0 International license under a which was this version posted September 20, 2018. ; https://doi.org/10.1101/418939 doi: bioRxiv preprint E xt endedD at aFi gu re 8: Stabilit y of manifold 336ring 336elds in the SM T. Sho wn for rat 103. Ea ch panel sho ws 336ring 336elds for one cell, for manifolds 336t separately to the 336rst and second half of the b eha vioral sessi on top and b ottom, resp ectiv ely The cen ter of mass of eac h 336ring 336eld is mark ed in red. To align the two manifolds, eac hw as rotated separately so that its 336rst principle comp onen tal igned with the ax is, and the second manifold w as re337ected along the ax es if necessary to max imize 336eld alignmen tb et w een the manifolds as measured by the P earson325s correlation co e cien tb et w een cen ter-of-mass v ectors for eac h manifold, consisting of the co ordinates of the cen ter of mass of eac h 336eld Fields are sho wn for the 15 c ells with the highest max im um 336ring rate across the b eha vi o ral session. 7.6 9.8 F ir ing rat Hz 27.9 15.8 16.8 19.5 10.1 14.4 13.6 18.5 6.1 5.5 8.4 6.6 2.1 4.0 5.7 4.6 6.0 6.5 2.3 9.4 Max firing Frequency 2d manifold 0 max 7 . CC-BY-NC-ND 4.0 International license under a which was this version posted September 20, 2018. ; https://doi.org/10.1101/418939 doi: bioRxiv preprint E xt endedD at aFi gu re 7: Ma ni fo ld 336 ring 336 eldsonthe 2 dS MT mani fo ld . Shown fo rrat 1 0 3 . Ea ch 336 elddepictscellacti vi ty vs . mani fo ld co o rdinates. Beha v ioral 336ring 336elds, whic h depict cell activ it yv s. sound freq uency , are also sho wn. Fields are sho wn for the tw en ty cells with the highest maxim um 336ring rate a cross the b eha vioral session. Environment 3d manifold, XY projection 3d manifold, YZ projection 3d manifold, XZ projection 25.8 11.9 22.2 15.4 18.6 9.4 11.0 12.4 19.0 17.1 8.8 16.4 18.8 13.5 17.8 11.6 11.7 16.8 12.0 6.1 20cm Max ! ring 6 . CC-BY-NC-ND 4.0 International license under a which was this version posted September 20, 2018. ; https://doi.org/10.1101/418939 doi: bioRxiv preprint E xt endedD at aFi gu re 6: Ma ni fo ld 336 ring 336 eldsonthe 3 d RF Tmani fo ld . Shown fo rrat 1 0 3 . Ea ch 336 elddepictscellacti vi ty vs . twoofthe 3d manifold co ordinates. Beha v ioral 336ring 336elds, whic h depict cell activ it yv s. p osition in the en v ironmen t, are also sho wn. Fields are sho wn f or the tw en ty cells with the highest max im um 336ring rate across the be ha v ioral session. En vir onmen tX En vir onmen tY 1 2 3 4 5 6 7 8 9 10 1 2 3 4 5 6 7 8 9 10 1 2 3 4 5 6 7 ab 0 0.2 0.4 0.6 0.8 1 1 2 3 4 5 6 7 8 9 10 0 0.2 0.4 0.6 0.8 1 1 2 3 4 5 6 7 8 9 10 1 2 3 4 5 6 7 dda , db estimator. 4 . CC-BY-NC-ND 4.0 International license under a which was this version posted September 20, 2018. ; https://doi.org/10.1101/418939 doi: bioRxiv preprint M anif old dimensionalit yM anif old dimensionalit yM anif old dimensionalit yM anif old dimensionalit y Simula tions with pr op er ties ma t ched to da ta I dealiz ed simula tions 1 2 3 4 5 6 7 8 9 10 R ec onstruc tion sc or e Optimal dimensionalit yR ec onstruc tion sc or e Optimal dimensionalit y Simula tion dimensionalit y Simula tion dimensionalit yrat 103, RFT V ar ianc ee xplained V ar ianc ee xplained Dimensionalit y sc or e Dimensionalit y sc or eE xt endedD at aFi gu re 4: We validatedourintrinsicdimensionalityestimatorde 336 nedbytakingthepeakoftheintrinsicdimensionality score on sim ulated datasets of prescrib ed dimensionalit y . Sim ulations w ere mo deled as place cells f or a rat f oraging in an arena whic h had the shap e of a high-dimensional ball, with constan t radius in all directi o ns see M etho ds Since our estimator returns the dimensonalit y suc h that the data most resem bles a unif orm -dimensional ball, it should estimate the co rrect dimensionalit y on the sim ulations. , Sim ulations with n um b er of cells, n um b er of time p oin ts, a nd 336ring prop erti es of eac h cel l matc hed to the RFT dataset for r at 103. Le ft Recons tr ucti on s cor e. Ri ght ,I ntrinsicdimensionalityscore . Undersamplingdoesnotresultinanincorrectdimensionalityestimateuntil =5 . Atthispoint , ouranalysisrequiresmoresamplese . g . morecells , orbetterexplorationofthemanifoldtodistinguishbetween the ma nifold whic h generated the data, and a manifold of lo w er dimensionalit y whic h 336ts the data w ell. A lternativ el y , a correct estimate can be obtained by imp osing stronger constrain ts on the reconstruction itself, by adjusting the hyper parameters of the M IN D algorithm. .T hesameanalysesformorehighly - sampledsimulations 1 2 8 cells , samenumberoftimepoints , tovalidatetheimplementationofthe .012 .013 .014 .015 .016 .022 .023 .024 .025 .026 .027 .026 .028 .030 .032 .034 .021 .022 .023 .024 .025 .026 .015 .017 .019 .021 .0130 .0132 .0134 .0136 RFT 1 2 3 4 1 2 3 4 1 2 3 4 1 2 3 4 1 2 3 4 1 2 3 4 1 2 3 4 1 2 3 4 RMSE RMSE RMSE RMSE RMSE RMSE Peer-prediction scores dimensionalities. 3 . CC-BY-NC-ND 4.0 International license under a which was this version posted September 20, 2018. ; https://doi.org/10.1101/418939 doi: bioRxiv preprint Ra t107 Rat 103 Rat 108 Rat 107 Ra t106 Rat 103 SM TM anif old dimensionalit yM anif old dimensionalit yM anif old dimensionalit yM anif old dimensionalit yM anif old dimensionalit yM anif old dimensionalit yE xt endedD at aFi gu re 3: Cross-v alidated, lea v e-one-cell-out 322p eer-prediction scor es323 for the RFT leftcol um nndSMrightcol um n as a function of manifold dimensionalit y . In these analy ses, eac h cell is held out in turn, and its activ it y is predicted from a manifold 336t to the remaining cells; the score is de336ned as the ro ot mean sq uared error RM SE b et w een the true and predicte d activ it y , av eraged ov erallchoicesoftheheld - outcellseeMethodsforafulldescription . Predictionscoressaturatedorattainedtheiropti mu matl ow Noise correlations Absolute noise correlations 3 Optimal Optimal 1 2 3 1 2 3 0 1 -1 .25 0 .25 0 0 1 -1 a 10 6 8 4 2 0 Manifold dimensionality 10 6 8 4 2 0 10 6 8 4 2 0 0 1 10 6 8 4 2 0 Manifold dimensionality 0 1 0 1 0 1 Manifold dimensionality Manifold dimensionality 2 d Noise correlation Absolute noise correlations 7.6 9.8 c 0 .4 0 .4 b Manifold dimensionality 1 2 3 4 5 6 7 8 9 10 Dimensionality of manifold ! t 1 2 3 4 5 6 7 8 9 10 ! MIND MIND Shu " es Shu " es a, b, ! c, a d, " Bottom: " 2 . CC-BY-NC-ND 4.0 International license under a which was this version posted September 20, 2018. ; https://doi.org/10.1101/418939 doi: bioRxiv preprint dimensionalit yR ec onstruc tion sc or e dimensionalit yR ec onstruc tion sc or eM ean absolut ev alue acr oss c ell pairs V ar ianc ee xplained Dimensionalit y sc or eV ar ianc ee xplained Dimensionalit y sc or eRat 106 Rat 107 N oise c orr ela tions D ensit yD ensit yD ensit yD ensit yA ll c ell pairs log kH zM anif old XM anif old YM anif old YM anif old XFr equenc yFr equenc yFr equenc yvs . manif old co or dina t es M anif old dimensionalit yM ean E uclidean er r or log kH zM ean E uclidean er r or log kH zFr equenc y dec o ding err or D ec oding fr om manif old c oor dina t es D ec oding fr om or ig inal r ing rat es PC A PC A Da ta Da ta E xt endedD at aFi gu re 2: Pr op er ti es of SMT mani fol ds for b eha vi or al s es si ons fr om r at 106 leftcol um nndra t1 0 rightcol um n See Fig. 2 captions fo r additional details. Left, v ar i ance expl ai ned vs . mani fol d di mens i onal ity , for MIND and PCA. Ri gh t, in tr i ns ic dimensionalit y score v s. manifold dimensionalit y . Er r or in deco di ng s ound fr equency fr om mani fol d co or di nates , for di er en tc hoi ces of manifold dimensionalit y , and fr om activ it yv ectors con taini ng the original 336ring rates. Error bars represen t s.d. ov er cross-v alidation fol ds . Repr es en tati on of b eha vi or al ong the 336r sttwo co or di na te s or der ed byv ar i ance of the opti mal mani fol d as es ti mated in Eac h datap oin t is colored by the v alues of the b eha v ioral v ariables at the corresp onding timep oin t. No isecorrelations , asinFig . 3 f. To p : Distribution of noise correlations across cell pairs. Sh u ed datasets pr es erv eb eha v ior-related correlations but destro y noise co rrel a ti o ns see M etho ds Me anabsolutevalueofnoisecorrelationsacrosscellpairs , comparedtothesameshu es asabove . Optimal Optimal 10 6 8 4 2 0 2 3 4 2 3 4 3 3 abc Manifold dimensionality 10 6 8 4 2 0 Manifold dimensionality Manifold dimensionality Manifold dimensionality 0 1 0 10 6 8 4 2 0 10 6 8 4 2 0 1 0 1 0 1 MIND 0 25 0 25 Manifold dimensionality Manifold dimensionality 1 2 3 4 5 6 7 8 9 10 1 2 3 4 5 6 7 8 9 10 ! MIND 0 70 En vi r onme ntXEn vi r onme ntYEn vi r onme ntXEn vi r onme ntY Manifold Y Manifold X 0 70 Manifold X Manifold Y ! a, b, ! c, a 1 . CC-BY-NC-ND 4.0 International license under a which was this version posted September 20, 2018. ; https://doi.org/10.1101/418939 doi: bioRxiv preprint Rat 107 Rat 108 dimensionalit yR ec onstruc tion sc or e dimensionalit yR ec onstruc tion sc or eM anif old dimensionalit y PC A Dimensionalit y sc or eV ar ianc ee xplained Dimensionalit y sc or eV ar ianc ee xplained M ean E uclidean er r or M ean E uclidean er r or P osition dec o ding err or D ec oding fr om manif old c oor dina t es D ec oding fr om or ig inal r ing rat es PC AP cm P cm P osition vs . rst two manif old dimensions E xt endedD at aFi gu re 1: Pr op er ti es of RF T mani fol ds for b eha vi or al s es si ons fr om r at 107 leftcol um nn dr a t1 0 rightcol um n See Fig. 2c aption sf oradditiona ld etails . Left, v ar i ance expl ai ned vs . mani fol d di mens i onal ity , for MIND and PCA. Ri gh t, in tr i ns ic di mens i onal ity score v s. manif old dimensionalit y . Er r or in deco di ng p os i ti on fr om mani fol d co or di nates , for di er en tc hoi ces of mani fol d di mens i onal ity , and from activ it yv ectors con taining the original 336ring rates. Error bars represen t s.d. ov er cro ss-v alidation folds. Repr es en ta ti on of be havioralongthe 336 rsttwocoordinatesorderedbyvarianceoftheoptimalmanifoldasestimatedin Eac h datap oin t is colored by the v alues of the b eha v iora lv ariables at the corresp ond i ng timep oin t. a 20cm ! y 5 2 3 4 b 1 Signi ! leads & lags -5 0 5 0.0 1.0 Cumulative probability 265 310 0 5 -5 -5 0 5 0.0 0.03 Fraction of timepoints R = 0.05 [-0.02, 0.12] 0 40 Reconstruction Error 0 20 0 5 Reconstruction Error 0 20 cd -5 0 5 Density 0.00 0.20 leading R = 0.06 [-0.02, 0.15] 1.178 s 0.518 261 0.001 s " a, b, Bottom c, Bottom d, Bottom 9 . CC-BY-NC-ND 4.0 International license under a which was this version posted September 20, 2018. ; https://doi.org/10.1101/418939 doi: bioRxiv preprint Ac tivit y leading Ac tivit y lagging Det our mo v es ahead and st ops Rat mo v es to meet it Tr ajec t or ies synchr oniz ed st ops br ie Ratc on tinues ahead 1. Tr ajec t or ies synchr oniz ed 2. beg ins to backtr ack 3. Rat st ops 4. div er ges in new dir ec tion 5. Tr ajec t or ies r ejoin Pr edic t ed fr om manif P oisson null model Ac tual position Pr edic t ed fr om manif old L ag distribution Tr ajec t or yr emains on manif old U sually synchr oniz ed , with local leads , lags , det ours Tr ajec t or ies synchr oniz ed A lw ays synchr oniz ed c an t 0 40 cm Reconstruction Error 0 20 0 5 s Reconstruction Error 0 20 cds -5 0 5 Density 0.00 0.20 Ac tivit y lagg ing Ac tivit yM ean abs . lag R eal da ta P oisson R eal da ta P oisson Sig ni can tFi gu re 4: Lo cal de viations from e nco d ing curr en tp osition. An al ys essho wn fo rrat 1 0 3 . Exampl e tr a jector i es s ho wi ng the r at325 s po sitionduringrandomforaginganditspredicted po sitiongiventhenetwork 325 sl oc ationonthemanifold . Populationactivitytypically enco ded the rat325s curren tp osition, but could lo cally dev iate to enco de future lead past lag or nearb y deto ur p ositi o ns. A ctiv it y under the P oisson n ull mo del enco ded instan taneous p osition by construction, pro ducing tigh t coupling b et w een actual a nd predicted p osition. Es ti mated ti me l ag b et w een the pr edi cted and actual p os i ti on. To p :P robabilitydensityfunctionoflagaggregatedacrosstimekernel densit y estimate :C orrespondingcumulativedistributionfunctionempiricalCDF . Thegrayregionisapointwise 9 5 % con 336 dence band and the ligh t blue curv e is the av erage across sy n thetic Poi sso n da tasets. The h yp othesis that lag in the real data exceeded tha t under the P oisson mo delw as tested at eac h timep oin t, con trolling the false disco v ery rate at a lev el of .05. To p :E stimatedlagateach timep oin t, for an ex ample in terv al. F or the P oisson mo del, the gra y region con tains the 2.5 to 97.5 p ercen tiles of the lag distribution at eac h timep oin t, and the blue curv e is the mean. :T herelativefrequencyofstatisticallysigni 336 canttimepointswitheachlag , expressed as a fraction of the total n um b er of timep oin ts included in the analy sis. The net w ork did not depart from the manifold during leading, lagging, or detour dev iations, as m easur ed by the manif old reconstruction erro r. To p :M anifoldreconstructionerrorvs . decodingerror . :M anifoldreconstructionerrorvs . absolutelag . Pointsanderrorbarsshowthemedianand 9 5 % bootstrapcon 336 denceintervals . Gra y regions violin pl ot sh ow the conditional densit yof reconstruction error giv en absolute lag. P earson correlation is sho wn wi th 9 5% bo otstrapcon 336 denceintervals . Wenext as kedwhetherthenetw or ktraject or yrem ai ns on them an if ol dduringdevi at i on sfr om encodingthecurrentp os iti on . Iftrue , theresh ou ldbenoincre as einthem an if ol drec on structi on err or , whichme as uresthedist an cebetween an ac tivityvect or an ditsprojecti on on them an if ol d as described ab ove . Devi at i on s 321w herep op ul at i on ac tivityencodesaloc at i on ot herth an ther at 325 scurrentp os iti on 321ar ech ar ac terizedby an incre as einp os iti on decodingerr or . Ho wever , rec on structionerr or an ddecodingerr or wereessenti al lyunc or rel at edFi g. 4d t op , ExtendedD at aFi g. 10c Pe ar s on c or rel at i on 0. 05, 95% CI [ - 0. 02, 0. 12] f or ther at showninFi g. 4; seeExtendedD at aFi g. 10c f or ot herr at s . Simil ar ly , therew as no ap p ar entrel at i on shipbetweenrec on structi on err or an dthem agn itude of l ag Fi g. 4d b ot t om , ExtendedD at aFi g. 10d Pe ar s on c or rel at i on 0. 06, 95% CI [ - 0. 02, 0. 15] f or ther at shownininFi g. 4; seeExtendedD at aFi g. 10d f or ot herr at s . Theref or e , hippoc am p al ac tivitydoesn ot dep ar tfr om them an if ol dduringle ad in g, l aggi n g, an ddet ou rdevi at i on s . R at her , therel at i on shipbetween ac tivity an dbehavi or ch an ge sm om ent ar ily : duringdevi at i on s , thenetw or ktraversesst at es on them an if ol dth at c or resp on dedtofuture , p as t , or ne ar bybehavi or al st at es . An intri gu ingp os sibilityisth at le ad s , l ags , an ddet ou rsmi gh tre 337 ectpredicti on , mem or y , or ment al expl or at i on processesinthehippoc am pus . 5, 12, 1432016, 39 Pri or w or k 3, 40 su gge ststh at t as kperf or m an ce , b ot hinsp at i al navi gat i on an dc ogn itiveprocessesin ge ner al , ac tiv at esasequence of neur al ac tivityinthehippoc am p al f or m at i on inwhich 336 ring 336 elds ar eelicitedp ar am etric al lywithpr ogr ess ! 7 When 261 261 p< 5 ! 10 ! 4 ! ! 8 . CC-BY-NC-ND 4.0 International license under a which was this version posted September 20, 2018. ; https://doi.org/10.1101/418939 doi: bioRxiv preprint m an if ol d . As in ou rc on ceptu al modelFi g. 1c , d , thesin gl e - tri al ac tivity of individu al neur on sre 337 ectedtheinter ac ti on of thistraject or ywith 336 ring 336 elds on them an if ol d . Inp ar ticul ar , theexistence of an extradimensi on bey on ds ou ndfrequency al lowed ac tivitytov ar yoverrepetiti on s of thes am efrequencyFi g. 3d , e . F or ex am ple , cellsc ou ldf ai lto 336 re at theirpreferredfrequencieswhenthe 2d traject or ytraversed ar ou nd , r at herth an thr ou gh their 336 ring 336 elds on them an if ol d 320s om ethingimp os siblef or a on e - dimensi on al systemFi g. 3d . Thisphen om en on al sooccurredf or the 3d RFTm an if ol dExtendedD at aFi g. 9 . Furtherm or e , despitethem on ot on icincre as einfrequency on everytri al , cellswith ad j ac ent 336 ring 336 elds on them an if ol dc ou ld 336 reindierent or der , depending on which 336 eldthetraject or yentered 336 rstFi g. 3e . Fin al ly , thef ac tth at p op ul at i on ac tivityisintrinsic al lylow - dimensi on al buthi gh er - dimensi on al th an thebehavi or su gge ststh at tri al - t o- tri al v ar i ab ilityisc or rel at ed ac r os scells . Suchc or rel at edv ar i ab ilityisc om m on lyreferredto as n oi sec or rel at i on , al th ou gh itmayre 337 ectunderlyingstructure , such as 337 uctu at i on inintern al st at es . p op ul at i on ac tivityisviewed as atraject or y on am an if ol dc ap turingtheseintern al st at es , n oi sec or rel at i on ar isesfr om the ar r an ge ment of 336 ring 336 elds on them an if ol d . F or ex am ple , thecellsshowninFi g. 3e 336 re at simil ar s ou ndfrequencies on aver age bec au setheirm an if ol d 336 ring 336 elds ar e al i gn ed al on gthe 336 rstdimensi on , whichencodesfrequency . Ho wever , these 336 elds ar el ar ge lyn on - overl ap pin g, an d ar e ar r an ge d al on gthesec on ddimensi on suchthatatraject or yav oi ding on e 336 eldmustnecess ar ilyp as sthr ou gh the ot her . Theref or e , gi vena 336 xeds ou ndfrequency , tri al - t o- tri al v ar i at i on of thetraject or y al on gthesec on ddimensi on willproduce an ti - c or rel at ed 337 uctu at i on sinthetwocells 325 ac tivity . Toqu an tifythise ! ect , weestim at edn oi sec or rel at i on sbetweenp ai rs of cellsintheSMTusingst an d ar dproceduresseeMethods . Wetestedthenullhyp ot hesis of zeron oi sec or rel at i on usingapermut at i on testwherepermut at i on sdestroyedn oi sec or rel at i on s , butpreservedbehavi or - rel at edc or rel at i on s ar isingfr om thefrequencytuning of e ac hneur on . Al lr at sh ad cellp ai rswithne gat ive an dp os itiven oi sec or rel at i on sexceedingth os einthepermutedd at aFi g. 3f , ExtendedD at aFi g. 2d . Theme an ab s ol uten oi sec or rel at i on ac r os scellsw as si gn i 336 c an tly gr e at erth an zero . 14 . 07, me an s . d . ac r os sr at s , p< . 004 f or e ac hr at . Thus , tri al - t o- tri al v ar i ab ilityisc or rel at ed ac r os scells , as expected gi venthem an if ol dstructure of p op ul at i on ac tivity . Ourc on ceptu al modeldescribesasec on dme an sbywhichtri al - t o- tri al v ar i ab ilityc ou ld ar ise : temp or ar ydec ou pling of neur al ac tivityfr om thecurrentbehavi or al c on diti on sFi g. 1f . As ab ove , thereisa ge ner al c or resp on dencebetweenintrinsicm an if ol dco or din at es an dme as uredbehavi or al v ar i ab lesFi g. 2c , d . Ho wever , thisc or resp on dencec ou ldm om ent ar ilybre ak ifthenetw or kweretomoveindependently al on gthem an if ol d . Totestthispicture , wedecodedther at 325 sp os iti on intheRFTfr om thenetw or k 325 s 3d co or din at es on them an if ol d . Thepredicted an d ac tu al traject or iesthr ou gh theenvir on mentweretypic al lysynchr on ized . Ho wever , thepredictedtraject or yc ou lddevi at eduringloc al episodes , inwhichnetw or k ac tivityencodedfuture , p as t , or ne ar byloc at i on sintheenvir on mentFi g. 4a . Werefertothesedevi at i on s as le ad s , l ags , an ddet ou rs , respectively . Predicted an d ac tu al traject or ieswerem or ecl os elysynchr on izedf or am an if ol d 336 tto ou rP oi ss on nullmodelFi g. 4a , where ac tivityencodesther at 325 scurrentp os iti on byc on structi on as ab ove . Toqu an tifyle ad ing an dl aggi ngdevi at i on s , weuseddyn am ictimew ar pingtoestim at ethetemp or al l ag betweenthepredicted an dtruep os iti on at e ac htimep oi nt . Thedistributi on of l ags overtimew as pe ak ed ar ou ndzer o, indic at ingth at thetraject or iesweretypic al lysynchr on ized . T ai ls of thedistributi on c or resp on dtoocc as i on al le ad ing an dl aggi ngdevi at i on sFi g. 4b , ExtendedD at aFi g. 10 . Thel ag distributi on f or theP oi ss on modelindic at esthem agn itude of le ad s an dl ags expectedbych an ce . Le ad an dl ag m agn itudes , me as uredbytheme an ab s ol utel ag, weresi gn i 336 c an tly gr e at erf or there al d at ath an theP oi ss on modelf or al lr at s , estim at edbyM on teC ar losimul at i on fr om theP oi ss on model . Toidentifyst at istic al lysi gn i 336 c an tle ad an dl ag eventswhilec on tr ol lingf or loc al traject or ypr op erties , wetestedthehyp ot hesis at e ac htimep oi ntth at ab s ol utel ag inthere al d at aexceededth at intheP oi ss on modelf al sediscoveryr at ec on tr ol led at thelevel . 05 . Si gn i 336 c an tle ad an dl ag eventswerepresentin al lr at s , withle ad soccurringm or efrequentlyth an l ags Fi g. 4c , ExtendedD at aFi g. 10 . R at s al soh ad si gn i 336 c an tdet ou reventsseeMethods , wherethe ac tu al p os iti on dieredstr on gl yfr om thepredictedp os iti on , an dthisdierencec ou ldn ot be ac c ou ntedf or byle ad or l ag. Si gn i 336 c an tle ad s , l ags an ddet ou rsduringr an d om f or agi ngbehavi or ar eillustr at edinSupplement ar y Vi deo 1 see al soExtendedD at aFi g. 11 . a, ! b, Bottom: " c, ! Bottom: d, Bottom: e, ! f, e # Bottom: # 7 . CC-BY-NC-ND 4.0 International license under a which was this version posted September 20, 2018. ; https://doi.org/10.1101/418939 doi: bioRxiv preprint Fi gu re 3: Ma nifoldtrajectoriesexplaintrial - to - trialvariabilityinthesoundmanipulationtask . An al ys essho wn fo rrat 1 0 3 . Le ft : Single-trial activ it y as a function of sound freq uency for an ex ample c ell cell 1 F req uency is normalized to range from 0 to 1 on a log scale. First 35 out of 59 trials are sho wn. Ri ght : Ac ti vi ty vs . fr e qu ency fo r 3 e xa mp letrials . Th eact iv it ypeakoccurredatadierent po sitionandamplitudeoneachtrial . To p : Distribution of p ositions and a mpl itudes of activ it yp eak s across trials, f or cell 1. A mplitudes are scaled to the cell325s max im um 336ring rate. The in terdecile range IDR of eac h di str i bution summarizes trial-to-trial v ariabilit y . An IDR closer to 1 indicates greater v ariabilit y . Po sitionandamplitudeIDRsforallanalyzedcellsthosewithsucientlyhigh 336 ringrate . Recons tr ucted acti vi tyi . e. the pr o jecti on of r eal acti vi ty on to the 2d mani fol d captur ed tr i al -to-tr i al v ar i abi lity . To p : Amp litude and p osition fo r real v s. reconstructed activ it yp eak s on eac h trial, for ce ll 1. Asa summary of reconstruction p erformance, the av erage absolute di erence b et w een real and reconstructed amplitudes and p ositions across trials me ana bsolute erro r, MAE is i ndicated. MAE betweenrealandreconstructedpositionsandamplitudes , fo rallanal yz edcells . To p : Ne tworktra je ctoryonthe 2 d ma ni fo ld fo r 3e xampl et rials . Overlai do nc el l1 325 sm anifol d336 rin g336 eld , depicte dh er ea sr econstructe da ctivityvs . manifol dc oordinates . Th en etwork 325 s path through the 336ring 336 e ld de termined the rec o nstructed activ it y for cell 1. Real and r econs tr ucted acti vi ty vs . s ound fr eq uenc y on eac h ex ample trial. Le ft : Beha v ioral 336ring 336elds f or cells 1 and 2. Ri ght : Ne tworktra je ctoryonthe 2 d ma ni fo ld fo r 3 dierent ex ample trials, ov erlaid on the manifold 336ring 336elds for eac h cell. In con trast to b eha v ioral 336ring 336elds, the manifold 336elds w ere nearly disjoin t. Co rresp ondingly , the single-trial activ it y of the two cells w as an ti-correlated, and their order of 336ring could v ary . Va riabilityon the manifold as in anlea dt on oisecorrelation sb etwee nc ells , de 336 ne da sp airwisecorrelation sn o tp redictedfro mt h ef requencytuning of eac h cell. To p : Distribution of noise correlations across cell pairs. Sh u ed datasets preserv eb eha v ior-related corr e lations but destro y noise correlations see M etho ds Me anabsolutevalueofnoisecorrelationsacrosscellpairs , comparedtothesameshuesas ab ov e. d 0 1 8 0 1 0 1 ef All cell pairs Mean absolute value across cell pairs Density Noise correlations -1 1 Position MAE Amplitude MAE 0 1 0 1 0 0 0 1 0 1 .05 * .13 * 0 1 1 Shu ! es Shu ! es Density ! ring ! elds peak position missed " eld on " " elds " 0 Absolute noise correlations 0 .25 a 11 17 25 17 Trial count .44 * .81 * Position Amplitude normalized " Position IDR Amplitude IDR 0 1 0 1 Cell count Cell count 0 1 0 1 10 3 3 0 0 1 1 Normalized frequency Trial number 8 0 0 35 1 b 0 Trial count 10 0 0 0 peak amplitude 8 0 8 0 1 0 1 Firing rate " " eld Normalized frequency 0 1 0 max Position Amplitude * decile Position * c 8 0 8 0 0 8 8 10 0 0 0 10 10 0 6 0 0 1 C ell 1 F ir ing ratHz Nor maliz ed fr equenc yC ell 1 vs . C ell 2 R eal R eal R ec on. C ell c oun tR ec onstruc tion per f or manc eR eal vs . r ec onstruc t ed positions and amplitudes R ec on. Da ta Da ta M anif old r ec onstr uc tion ma t ches single -trial ac tivit yTr ajec t ories thr ough on manif old V ar iable Single -tr ial ac tivit yM anif old r ec onstruc tion Tr ajec t or ye xplains single tr ials M anif old e xplains str uc tur e in pair wise v ariabilit yB eha vior al r ing ov er lap Single tr ial ac tivit y is an ti- c or r ela t ed C ells re in opposit e or der on di # er en t tr ials Ac tivit yvs . sound fr equenc yP osition and amplitude v ar iabilit yV ariable single -trial ac tivit yTr ial 25 Tr ial 17 Tr ial 11 Tr ial 11 Summar y of v ariabilit y acr oss trials P osition and amplitude of ac tivit y peaks acr oss tr ials C ell 1 P opula tion V ar iable C ell c oun tN oise c orr ela tions C ell 1 ac tivit yC ell 1 r ec on. C ell 2 ac tivit yC ell 2 r ec on. Nor maliz ed fr equenc yB eha vior al r ing Single -tr ial ac tivit yTr ial 17 Tr ial 25 Normalized frequency 0 1 Nor maliz ed fr equenc yC ell 1 F ir ing rateInt er - r ange A mplitude M AE C ell 1 C ell 1 Tr ial C ell 1 P opula tion F ir ing ratHzdb ! dbdb 261 261 261 db 3 ! ! 6 261 261 261 261 261 261 6 . CC-BY-NC-ND 4.0 International license under a which was this version posted September 20, 2018. ; https://doi.org/10.1101/418939 doi: bioRxiv preprint theneur al ac tivityisn ot c om pletelydeterminedbytheme as uredbehavi or al v ar i ab les , an dmayencode ad diti on al inf or m at i on . Toch ar ac terizetherel at i on shipbetweenthem an if ol d an dbehavi or , we 336 rst at temptedtodecodether at 325 sinst an t a- ne ou sp os iti on intheRFT or s ou ndfrequencyintheSMTfr om theintrinsicm an if ol dco or din at es at e ac htimep oi ntFi g. 2c , ExtendedD at aFi gs . 1b , 2b . Decodingperf or m an ce at the op tim al m an if ol ddimensi on al ityidenti 336 ed as ab ovew as c om p ar ab letoth at ac hievedwiththe or i gi n al 336 ringr at esme an Euclide an decodingerr or withm an if ol dco or din at esvs . 336 ringr at es : 11 vs . 11 cmf or RFT , . 28 vs . . 32 l og k Hz f or SMT ; me an ac r os sr at s . Thus , them an if ol dc ap tures al linf or m at i on ab ou tme as uredbehavi or al v ar i ab lesth at isav ai l ab letothedecoderintheraw 336 ringr at es . Decodingperf or m an cew as simil ar f or m an if ol ds 336 t at alowerdimensi on al ity , equ al tothethenumber of behavi or al v ar i ab lesFi g. 2c , ExtendedD at aFi gs . 1b , 2b . Bec au sem an if ol ddimensi on s ar en on - redund an t , thissu gge ststh at theextradimensi on weidenti 336 ed ab ovec ar rieslittleinf or m at i on ab ou tme as uredbehavi or al v ar iables . R at her , itrepresents ad diti on al inf or m at i on instructuredp op ul at i on ac tivity . P os iti on an ds ou ndfrequencywereencodedsmo ot hly al on gthem an if ol d , an dch an ge ine ac hv ar i ab lec or resp on dedtoc on tinu ou smovement al on gadierentdirecti on on them an if ol dFi g. 2d , ExtendedD at aFi gs . 1c , 2c . Toqu an tifythisrel at i on ship , wec om p ar eddist an cesbetweenc or resp on dingp ai rs of p oi ntswhenc al cul at edusingthe - dimensi on al behavi or al co or din at esversusthe 336 rstm an if ol dco or din at eswith gr e at estv ar i an ce . P ai rwisedist an cesinb ot hsp ac eswerec or rel at ed , indic at ing ge om etricsimil ar itybetweenthem an if ol d an dbehavi or Pe ar s on c or rel at i on . 70 . 06 f or RFT an d . 55 . 16 f or SMT ; me an s . d . ac r os sr at s . Thus , them an if ol dc ap turesam ap - likerepresent at i on of behavi or al v ar i ab lesintheneur al ac tivity , an dMI ND c an recoverthisrepresent at i on in an unsupervisedm an ner . Inc om p ar is on , rel at edm an if ol dle ar ning al gor ithmsis om ap an dPCAdidn ot reproducethis ge om etricstructure , an dpreservedlessinf or m at i on ab ou tbehavi or ExtendedD at aFi g. 5, Methodssecti on 18 . M an yneur on sf or medc om p ac t 336 ring 336 elds on them an if ol d , indic at ingth at they 336 redpreferenti al lyinaloc al nei gh b or - hood of netw or kst at es , as in ou rc on ceptu al modelFi g. 1c , 2e , ExtendedD at aFi gs . 6, 7 . Fieldp os iti on srem ai nedst ab lewhenm an if ol dswere 336 tsep ar at elytoe ac hh al f of thebehavi or al sessi on ExtendedD at aFi g. 8 , su gge stingth at m an if ol d 336 ring 336 eldsrepresent ge nuinec on str ai nts on therel at i on shipbetweencell ac tivity an dnetw or kst at eth at persistthr ou gh ou ttheloc al behavi or al c on text . Whenviewed al on gthe 336 rstm an if ol dco or dinates , these 336 eldsl ar ge lyrec ap itul at edthecells 325 loc al izedbehavi or al 336 ring 336 elds , as expected gi venthe ge om etricsimil ar ity of thebehavi or al sp ac e an dthem an if ol d al on gthesedimensi on sFi g. 2e , ExtendedD at aFi gs . 6, 7 . Ho wever , as ab ove , them an if ol dc on t ai ned an extradimensi on bey on dtheme as uredbehavi or al v ar i ab les . M an ycells 325 336 ring 336 eldswereloc al ized an dst ab le al on gthisextradimensi on as well , su gge stingth at their 336 ringre 337 ects ad diti on al structurebey on dtheencoding of me as uredbehavi or al v ar i ab lesFi g. 2e , ExtendedD at aFi gs . 6, 7 . C ou ldthisextradimensi on ac c ou ntf or tri al - t o- tri al v ar i ab ility , as in ou rc on ceptu al model ? IntheSMT , ther at sweptthr ou gh thes am es ou ndfrequencies on everytri al , an dm an ycellsh ad frequency - tunedbehavi or al 336 ring 336 elds . Ho wever , they 336 red at adierents ou ndfrequency an dwithadierentnumber of spikes on e ac htri al Fi g. 3a . Wequ an ti 336 edthisv ar i ab ilitybyex am iningsin gl e - tri al ac tivity as afuncti on of s ou ndfrequency , an destim at ingthen or m al izedp os iti on an d am plitude of the ac tivitype ak on e ac htri al . Theinterdeciler an ge IDR ac r os stri al sme as uredthep os iti on an d am plitudev ar i ab ility of e ac hcell , r an gi ngfr om 0 nov ar i ab ilityto 1 m ax imumv ar i ab ilityFi g. 3b . As previ ou sly ob servedinsp at i al t as ks , m an ycellsexhibitedhi gh v ar i ab ilityintheSMTp os iti on IDR . 56 . 25, am plitudeIDR . 69 . 11, me an s . d . f or al lcells ac r os sr at s . P os iti on v ar i ab ilityw as br oad lydistributed ac r os scells , where as ne ar ly al lcellsh ad hi gh lyv ar i ab lepe ak am plitudes . Despitethisv ar i ab ility , therecoveredm an if ol dsuccessfullypredictedsin gl e - tri al ac tivity . As ab ove , ac tivityrec on - structi on s ac c ou ntedf or m os t of thev ar i an ceintherawneur al ac tivityFi g. 2b . Furtherm or e , intheSMT , sin gl e - tri al pe ak p os iti on s an d am plitudesintherec on structed ac tivitym at chedth os einthe or i gi n al d at aFi g. 3c me an ab s ol uteerr or . 09 . 06 f or p os iti on , . 14 . 08 f or am plitude ; me an s . d . ac r os scells an dr at s . Thus , tri al - t o- tri al v ar i ab ilityisn ot ar bitr ar y . R at her , itc or resp on dstov ar i at i on inthetraject or y of theentirep op ul at i on al on galow - dimensi on al a, b, c, d, b e, in d Bottom: d,e scaling. 5 . CC-BY-NC-ND 4.0 International license under a which was this version posted September 20, 2018. ; https://doi.org/10.1101/418939 doi: bioRxiv preprint Fi gu re 2: Prop erties of hipp o campal activit y manifolds. An al ys essho wn fo rrat 1 0 3 duringone RF Tsessionleftcol um nnd one SM T session rightcol um n Depiction of task structure. Le ft : Fr actionofvarianceinthepopulationactivityexplained by manifoldsofincreasingdimensionality , constructedbyMIND . Incomparison , thefractionofvarianceexplainedbyoptimallinear manifolds as constructed by PCA. Ri ght : In tr insic di mens i onal itys cor e vs . mani fol d di mens i onal ity . We us ed the p eak of the in tr i ns ic dimensionalit y score to sel ect an optimal dim ensiona l it y . In comparison to aP oisson n ull mo del whose activ it yw as determined by the measured b eha vioral v ariables, the hipp o campal activit y had an extra dimension. Gra y band indicates stand ard error across syn thetic Po issondatasets . Deco ding error when predicting b eha vi o ral v ariables f rom in trinsic manif old co ordinates of increasing dime nsiona li ty , or from activ it yv ectors con taining the original 336ring rates. Error bars represen t s.d. ov er cross-v alidation f olds. Repr es en ta ti on of be havioralongthe 336 rsttwoc oo rdinatesorderedbyvarianceoftheoptimalmanifoldRFT 3 d , SMT 2 d , asestimatedin Eac h datap oin t is colo red by the v alues of the b eha v ioral v ariables at the corresp onding timep oin t. To p : Ma ni fo ld 336 ring 336 el ds fo r 3 cells fr om eac h task, depicting 336ring rate as a function of manifold co ordinates. V isualize d along th e 336rst two co ordinates of the optimal manifold, as .E achcell 325 smaximum 336 ringrateisindicated . Beha v ioral 336ring 336elds f or the same cells, depicting 336ring rate as af unction of measured b eha vioral v ariables. F or visual comparison, the manifold plots in are aligned to the b eha v ioral co ordinates by rotation and S ound manipul aR andom foragbacdRec onstru c tion score Rec onstru c tion score Variance explained 0 1 .5 Dimensionality score 0 1 Dimensionality score 0 1 Optimal dimensionality Variance explained 0 1 .5 2 3 4 MIN D PCA 1 2 3 Optimal dimensionality e Data Poisson model Data P oisson model MIN DPCA 2 3 1 2 Manifold dimensionality Manifold dimensionality Manifold dimensionality Manifold dimensionality 2 Reward zone ! ring ! ! ring ! elds 20cm Firing rate Environment Manifold ! Frequency 7.6 9.8 Firing rate 1 25 0 0 .4 Mean Euclidean error log kH Mean Euclidean error 10 2 3 4 5 6 7 8 9 1 10 2 3 4 5 6 7 8 9 Fr equen cy Manifold dimensionality Manifold dimensionality Position Decoding from manifold coordinates Decoding from original ! ring rates 0 max 1 10 2 3 4 5 6 7 8 9 1 10 2 3 4 5 6 7 8 9 1 10 2 3 4 5 6 7 8 9 1 10 2 3 4 5 6 7 8 9 RFT 0 max Environment Y Environment X Food pellet 7.6 9.8 P 0 70 En vi r onme ntXEn vi r onme ntYFr equen cy Environment X Environment Y Manifold X Manifold X Manifold Y Manifold Y ! M anif old dimensionalit yM anif old elds and b eha vior al Fr equenc y log kH z 13.6 Hz 14.4 Hz 19.5 Hz 22.2 Hz 11.7 Hz Dec o ding err or 25.7 Hz SM TB eha vior al v ariables vs . rst two manif old dimensions ! ! ! ! 3 3 dd 261 d 261 27 ddddd 6 dd " 4 . CC-BY-NC-ND 4.0 International license under a which was this version posted September 20, 2018. ; https://doi.org/10.1101/418939 doi: bioRxiv preprint v ar i ab ilityc an ar ise . First , theextr a, hiddendimensi on s al lowthesystemtot ak edierenttraject or iesthr ou gh 336 elds on them an if ol devenifbehavi or al c on diti on s ar e 336 xed . Individu al neur on smaythus 336 rewithdierent am plitudes an dindierentbehavi or al c on diti on s on e ac htri al Fi g. 1d . Theymayeven 336 reindierent or der , or f ai lto 336 rewhenthethetraject or yc om pletelymissesa 336 eld on them an if ol d . Ho wever , them an if ol dc on str ai nsthev ar i ab ilityth at c an occur . F or ex am ple , them an if ol d 325 sloc al t op ol ogy limitsthep os siblesequencesinwhichcellsc an 336 reFi g. 1e . Sec on d , tri al - t o- tri al v ar i ab ilityc an al so ar iseifp op ul at i on ac tivitytemp or ar ilydec ou plesfr om currentbehavi or al c on diti on s , as mi gh toccurduringsp on t an e ou smem or y , predicti on , or ment al expl or at i on events . 5, 12, 1432016, 39 In ou rmodel , suchdevi at i on sfr om thetypic al encodingc or resp on dtothenetw or kmoving al on gthem an if ol dindependently of me as uredbehavi or al v ar i ab lesFi g. 1f . Totest ou rc on ceptu al model , we an al yzedp op ul at i on ac tivityrec or dedfr om thed or s al C A1 hippoc am p al re gi on of 4 r at s . In ad diti on toast an d ar dsp at i al t as kr an d om f or agi ngt as k , RFT , ther at sperf or medanovels ou ndm an ipul at i on t as kSMTwheretheyrem ai nedina 336 xedp os iti on , an dpressedaleverto ad just an au dit or yt on etoa goal frequencyFi g. 2a . Individu al neur on sh ad loc al izedbehavi or al 336 ring 336 elds on theenvir on mentRFT or s ou ndfrequencySMT , whichc ol lectivelyrepresentedtheme as uredbehavi or al v ar i ab les . F or ou r an al yses , wecre at edp op ul at i on ac tivityvect or sfr om the 336 ringr at es of simult an e ou slyrec or dedcells , whichwe an al yzedsep ar at elyf or e ac hbehavi or al sessi on . Westudied 6 sessi on sint ot al , 3 fr om e ac ht as k , with 15- 52 neur on spersessi on . To as sesswhetherthehippoc am p al ac tivityw as c on str ai nedtoalow - dimensi on al m an if ol d , weusedMI ND to 336 tm an if ol ds of incre as ingdimensi on al ity . F or e ac hch oi ce of dimensi on al ity , wem ap ped ac tivityvect or sto - dimensi on al intrinsicm an if ol dco or din at es , whichwethenm ap pedb ac kto ac tivitysp ac etode 336 nerec on structed ac tivityvect or s ; theserepresenttheprojection of the or i gi n al ac tivity on tothem an if ol d 336 tbyMI ND . Wec om putedarec on structi on sc or e , de 336 ned as thefr ac ti on of v ar i an ceinthe ac tivityvect or sexpl ai nedbytherec on structed ac tivityvect or s , whichw as cl os erto 1 whenthe ac tivityw as cl os ertothem an if ol d . Therec on structi on sc or es at ur at ed at alowdimensi on al ity ac r os sbehavi or al sessi on sinb ot ht as ks . 91 . 05 by = 3; me an s . d . ; Fi g. 2b , ExtendedD at aFi gs . 1 an d 2 , indic at ingth at thehippoc am p al p op ul at i on ac tivityliesne ar alow - dimensi on al m an if ol d . Toc on tr ol f or over 336 ttin g, wec om putedcellpredicti on sc or eswheree ac hm an if ol dw as usedtopredictthe ac tivity of held - ou tcells , whichs at ur at ed or at t ai nedtheir op timum at lowdimensi on al itiesExtendedD at aFi g. 3 . Totestwhethertherec on structedm an if ol dsweren on line ar , wec om p ar edMI ND toprincip al c om p on ent an al ysisPCA , whichrecoversline ar m an if ol dswith op tim al rec on structi on sc or eFi g. 2b , ExtendedD at aFi gs . 1 an d 2 . MI ND at t ai ned gr e at errec on structi on sc or es at lowerdimensi on al ity , p ar ticul ar lyf or theRFT , wherePCArequired an or der of m agn itudem or edimensi on store ac hthes am eperf or m an ce . As afurtherc on tr ol toensureth at low - dimensi on al m an if ol d 336 tsweren ot inevit ab le , weveri 336 edth at hi gh - dimensi on al simul at i on swithpr op ertiesm at chedtothed at aweren ot well - 336 t at lowdimensi on al itiesExtendedD at aFi g. 4 . Thus , inb ot ht as ks , ou rresultssu gge stth at hippoc am p al p op ul at i on ac tivityisrestrictedtoliene ar alow - dimensi on al , n on line ar m an if ol d . Toestim at etheintrinsicdimensi on al ity of thehippoc am p al ac tivity , we 336 tm an if ol ds at e ac hdimensi on al ity , as ab ove . F or e ac h , wec om puted an intrinsicdimensi on al itysc or eIDS , seeMethods . Weto ok thepe ak of theIDScurvetode 336 nethe op tim al dimensi on al ity , an dwev al id at edthisestim at or on simul at edd at as etsExtendedD at aFi g. 4 . F or thehippoc am p al ac tivity , the op tim al m an if ol ddimensi on al ityine ac ht as kexceededthenumber of me as uredbehavi or al v ar iablesRFT , = 3 f or al lr at s , SMT , = 2 f or r at s 103 an d 106, = 3 f or r at 107; Fi g. 2b , ExtendedD at aFi gs . 1 an d 2 . Thissu gge ststh at thebehavi or al v ar i ab lesdon ot c om pletelydeterminetheneur al ac tivity , whichv ar ies al on ga gr e at ernumber of dimensi on s . As ac on tr ol , we an al yzedsyntheticp op ul at i on ac tivityfr om aP oi ss on nullmodel , wheree ac hneur on 325 s ac tivityw as ge ner at ed ac c or dingtoitsbehavi or al 336 ring 336 eld , an ddidn ot c on t ai n an ys ou rces of v ar i ab ilitybey on dP oi ss on n oi se . Inthisc as e , wef ou ndneur al ac tivitym an if ol dswh os edimensi on al itiesm at chedtheme as uredbehavi or al v ar i ab les = 2, RFT , = 1, SMT ; Fi g. 2b . Theref or e , inc on tr as ttothev ar i ab ilityinthed at a, P oi ss on v ar i ab ilityisn ot sucienttoincre as ethedimensi on al ity of them an if ol d , providingfurtherevidenceth at theneur al v ar i ab ilityrepresentsstructurer at herth an n oi se . Insumm ar y , ou r an al ysesindic at eth at thehippoc am p al ac tivityiswell - 336 tbyn on line ar m an if ol ds of dimensi on muchlessth an thenumber of neur on s . Ho wever , f or e ac ht as k , the ac tivitym an if ol dh as at le as t on eextradimensi on , su gge stingth at